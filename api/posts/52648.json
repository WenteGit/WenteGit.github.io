{"title":"Cloud-Base","slug":"Cloud_Base","date":"2022-07-19","updated":"2022-11-15","comments":true,"path":"api/posts/52648.json","excerpt":"<blockquote><p>SpringCould 的学习随堂笔记 </p></blockquote>","cover":"http://xtzl.wentexl.cn/restTemplate%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1.png","covers":["http://xtzl.wentexl.cn/restTemplate%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1.png"],"content":"<blockquote>\n<p>SpringCould 的学习随堂笔记</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<h1 id=\"SpringCould- 随堂笔记\"><a href=\"#SpringCould- 随堂笔记\" class=\"headerlink\" title=\"SpringCould 随堂笔记\"></a>SpringCould 随堂笔记</h1><blockquote>\n<h2 id=\"父工程框架\"><a href=\"# 父工程框架\" class=\"headerlink\" title=\"父工程框架\"></a>父工程框架</h2></blockquote>\n<blockquote>\n<h3 id=\"父工程统一管理 Jar 包\"><a href=\"# 父工程统一管理 Jar 包\" class=\"headerlink\" title=\"父工程统一管理 Jar 包\"></a>父工程统一管理 Jar 包</h3></blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.source</span>&gt;</span>12<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.source</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.target</span>&gt;</span>12<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.target</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">junit.version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">junit.version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">lombok.version</span>&gt;</span>1.18.10<span class=\"tag\">&lt;/<span class=\"name\">lombok.version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">log4j.version</span>&gt;</span>1.2.17<span class=\"tag\">&lt;/<span class=\"name\">log4j.version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">mysql.version</span>&gt;</span>8.0.21<span class=\"tag\">&lt;/<span class=\"name\">mysql.version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">druid.version</span>&gt;</span>1.0.9<span class=\"tag\">&lt;/<span class=\"name\">druid.version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">mybatis.spring.boot.version</span>&gt;</span>2.2.2<span class=\"tag\">&lt;/<span class=\"name\">mybatis.spring.boot.version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<h3 id=\"必要依赖\"><a href=\"# 必要依赖\" class=\"headerlink\" title=\"必要依赖\"></a>必要依赖</h3></blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--spring boot 2.2.2--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>Hoxton.SR1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<blockquote>\n<h2 id=\"子工程 application 配置文件\"><a href=\"# 子工程 application 配置文件\" class=\"headerlink\" title=\"子工程 application 配置文件\"></a>子工程 application 配置文件</h2></blockquote>\n<h3 id=\"数据源配置\"><a href=\"# 数据源配置\" class=\"headerlink\" title=\"数据源配置\"></a>数据源配置</h3><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">datasource:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">  <span class=\"attr\">driver-class-name:</span> <span class=\"string\">org.gjt.mm.mysql.Driver</span></span><br><span class=\"line\">  <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"唯一标识\"><a href=\"# 唯一标识\" class=\"headerlink\" title=\"唯一标识\"></a>唯一标识</h3><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">cloud-payment-service</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Devtools- 开启热部署\"><a href=\"#Devtools- 开启热部署\" class=\"headerlink\" title=\"Devtools 开启热部署\"></a>Devtools 开启热部署</h2><blockquote>\n<p>注：电脑不太行不建议开启，太锤子卡了</p>\n<ol>\n<li>导入 jar 包</li>\n<li>引 spring-boot-maven-plugin 插件</li>\n<li>在 IDEA 的 Compile 中调设置.</li>\n<li>重启 IDEA</li>\n</ol>\n</blockquote>\n<h2 id=\"RestTemplate\"><a href=\"#RestTemplate\" class=\"headerlink\" title=\"RestTemplate\"></a>RestTemplate</h2><blockquote>\n<p>可用 订单 80 端口去调用 8001 端口的服务进行操作</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> RestTemplate <span class=\"title function_\">getRestTemplate</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RestTemplate</span>();</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<h3 id=\"两种方式：\"><a href=\"# 两种方式：\" class=\"headerlink\" title=\"两种方式：\"></a>两种方式：</h3></blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"comment\">// 第一种是写死的，第二种是 URL 为集群的服务名 </span></span><br><span class=\"line\">  <span class=\"comment\">// 微服务可能有多个端口</span></span><br><span class=\"line\">   <span class=\"comment\">// public static final String PAYMENT_URL=&quot;http://localhost:8001&quot;;</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String PAYMENT_URL=<span class=\"string\">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RestTemplate restTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// GET 请求实际上调用了 POST 请求</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> CommonResult&lt;Payment&gt; <span class=\"title function_\">create</span><span class=\"params\">(Payment payment)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> restTemplate.postForObject(PAYMENT_URL+<span class=\"string\">&quot;/payment/create&quot;</span>,payment,CommonResult.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> CommonResult&lt;Payment&gt; <span class=\"title function_\">getPayment</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class=\"line\">        System.out.println(id);</span><br><span class=\"line\">        log.info(String.valueOf(id));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> restTemplate.getForObject(PAYMENT_URL+<span class=\"string\">&quot;/payment/get/&quot;</span>+id,CommonResult.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> 坑： 此处我使用<span class=\"meta\">@Pathgram</span> 无法获取到路径变量</span><br></pre></td></tr></table></figure>\n<p><strong>细节</strong>  </p>\n<blockquote>\n<p>在微服务的 Controller 中，涉及到 POST 请求，一定不要忘记加 @RequstBody 这个注解，当 80 端口的请求到微服务端口的方法时</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/payment/create&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> CommonResult <span class=\"title function_\">create</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> Payment payment)</span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"负载均衡\"><a href=\"# 负载均衡\" class=\"headerlink\" title=\"负载均衡\"></a>负载均衡</h1><blockquote>\n<p>微服务没被写死端口号的时候 <br> 在配置类里面必须加 @LoadBalanced 才行<br>@LoadBalanced 赋予 RestTemplate 负载均衡的能力: 轮班值日</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@LoadBalanced</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> RestTemplate <span class=\"title function_\">getRestTemplate</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RestTemplate</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>RestTemplate 返回对象选择</strong><br><img src=\"http://xtzl.wentexl.cn/restTemplate%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1.png\" alt=\"RestTemplate 返回\"></p>\n</blockquote>\n","url":"/posts/52648/","min2read":3,"word4post":718,"prev_post":{"title":"Maven_Write","url":"/posts/35182/"},"next_post":{"title":"CppFunctions","url":"/posts/12049/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"SpringCould- 随堂笔记\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">SpringCould 随堂笔记</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"父工程框架\" href = \"#\"><span class=\"toc-number\">1.1.</span> <span class=\"toc-text\">父工程框架</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"父工程统一管理 Jar 包\" href = \"#\"><span class=\"toc-number\">1.1.1.</span> <span class=\"toc-text\">父工程统一管理 Jar 包</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"必要依赖\" href = \"#\"><span class=\"toc-number\">1.1.2.</span> <span class=\"toc-text\">必要依赖</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"子工程 application 配置文件\" href = \"#\"><span class=\"toc-number\">1.2.</span> <span class=\"toc-text\">子工程 application 配置文件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"数据源配置\" href = \"#\"><span class=\"toc-number\">1.2.1.</span> <span class=\"toc-text\">数据源配置</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"唯一标识\" href = \"#\"><span class=\"toc-number\">1.2.2.</span> <span class=\"toc-text\">唯一标识</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"Devtools- 开启热部署\" href = \"#\"><span class=\"toc-number\">1.3.</span> <span class=\"toc-text\">Devtools 开启热部署</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"RestTemplate\" href = \"#\"><span class=\"toc-number\">1.4.</span> <span class=\"toc-text\">RestTemplate</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"两种方式：\" href = \"#\"><span class=\"toc-number\">1.4.1.</span> <span class=\"toc-text\">两种方式：</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"负载均衡\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">负载均衡</span></a></li></ol>","categories":[{"name":"SpringCould","path":"api/categories/SpringCould.json","url":"/categories/SpringCould/"}],"tags":[{"name":"SpringCould","path":"api/tags/SpringCould.json","url":"/tags/SpringCould/"}]}