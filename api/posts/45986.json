{"title":"Online-bug","slug":"Online-bug","date":"2024-01-06","updated":"2024-01-08","comments":true,"path":"api/posts/45986.json","excerpt":"<blockquote><p> 线上 bug 的排查 </p></blockquote>","cover":null,"covers":null,"content":"<blockquote>\n<p>线上 bug 的排查</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"常见的线上 bug\"><a href=\"# 常见的线上 bug\" class=\"headerlink\" title=\"常见的线上 bug\"></a>常见的线上 bug</h1><h2 id=\"大对象\"><a href=\"# 大对象\" class=\"headerlink\" title=\"大对象\"></a>大对象</h2><blockquote>\n<p>系统一次性加载了过多数据到内存中（比如 SQL 查询未做分页），导致大对象进入了老年代</p>\n</blockquote>\n<h2 id=\"内存泄漏\"><a href=\"# 内存泄漏\" class=\"headerlink\" title=\"内存泄漏\"></a>内存泄漏</h2><blockquote>\n<p>频繁创建了大量对象，但是无法被回收（比如 IO 对象使用完后未调用 close 方法释放资源），先引发 FGC，最后导致 OOM</p>\n</blockquote>\n<h2 id=\"JVM 参数设置\"><a href=\"#JVM 参数设置\" class=\"headerlink\" title=\"JVM 参数设置\"></a>JVM 参数设置</h2><blockquote>\n<p>包括总内存大小、新生代和老年代的大小、Eden 区和 S 区的大小，设置的不够合理</p>\n</blockquote>\n<h2 id=\"程序频繁生成一些长生命周期的对象\"><a href=\"# 程序频繁生成一些长生命周期的对象\" class=\"headerlink\" title=\"程序频繁生成一些长生命周期的对象\"></a>程序频繁生成一些长生命周期的对象</h2><blockquote>\n<p>当这些对象的存活年龄超过分代年龄时便会进入老年代，最后引发 FGC</p>\n</blockquote>\n<h1 id=\"JVM 参数\"><a href=\"#JVM 参数\" class=\"headerlink\" title=\"JVM 参数\"></a>JVM 参数</h1><blockquote>\n<p>打印 GC 日志：  </p>\n<ul>\n<li>XX：+PrintGCDetails</li>\n<li>XX：+UseConcMarkSweepGC<br>堆的最小大小：  </li>\n<li>Xms20m<br>堆的最大大小：  </li>\n<li>Xmx20m<br>当 OutOfMemoryError 发生时自动生成 Heap Dump 文件  </li>\n<li>XX：+HeapDumpOnOutOfMemoryError<br>当 JVM 执行 FullGC 前执行 dump  </li>\n<li>XX：+HeapDumpBeforeFullGC<br>当 JVM 执行 FullGC 后执行 dump    </li>\n<li>XX：+HeapDumpAfterFullGC<br>指定 dump 文件存储路径</li>\n<li>XX：HeapDumpPath=/home/dumps</li>\n</ul>\n</blockquote>\n<h1 id=\"JVM 命令\"><a href=\"#JVM 命令\" class=\"headerlink\" title=\"JVM 命令\"></a>JVM 命令 </h1><h2 id=\"jmap\"><a href=\"#jmap\" class=\"headerlink\" title=\"jmap\"></a>jmap</h2><h3 id=\"下载 dump 文件\"><a href=\"# 下载 dump 文件\" class=\"headerlink\" title=\"下载 dump 文件\"></a> 下载 dump 文件 </h3><h4 id=\"命令解释\"><a href=\"# 命令解释\" class=\"headerlink\" title=\"命令解释\"></a> 命令解释</h4><blockquote>\n<ul>\n<li>使用 jdk 的 jmp 命令导出 dump 文件</li>\n<li>format=b 表示文件是二进制文件</li>\n<li>file 是指定 dump 文件的下载地址</li>\n</ul>\n</blockquote>\n<h4 id=\"命令\"><a href=\"# 命令\" class=\"headerlink\" title=\"命令\"></a>命令</h4><blockquote>\n<p>jmap -dump:format=b,file=/home/dumps 进程 pid</p>\n</blockquote>\n<h3 id=\"查看当前的活动对象\"><a href=\"# 查看当前的活动对象\" class=\"headerlink\" title=\"查看当前的活动对象\"></a>查看当前的活动对象 </h3><h4 id=\"命令解释 -1\"><a href=\"# 命令解释 -1\" class=\"headerlink\" title=\"命令解释\"></a> 命令解释</h4><blockquote>\n<ul>\n<li>histo:live 表示生成直方图时只考虑活动对象</li>\n</ul>\n</blockquote>\n<h4 id=\"命令 -1\"><a href=\"# 命令 -1\" class=\"headerlink\" title=\"命令\"></a>命令</h4><blockquote>\n<p>jmap -histo:live pid</p>\n<hr>\n</blockquote>\n<h2 id=\"jstat\"><a href=\"#jstat\" class=\"headerlink\" title=\"jstat\"></a>jstat</h2><h3 id=\"查看当前堆内存各部分的使用量\"><a href=\"# 查看当前堆内存各部分的使用量\" class=\"headerlink\" title=\"查看当前堆内存各部分的使用量\"></a>查看当前堆内存各部分的使用量</h3><blockquote>\n<ul>\n<li>gc 是查看要监视的是垃圾收集相关的统计信</li>\n<li>1000 是指每 1000ms 输出一次</li>\n<li>10 是指一共输出 10 次</li>\n</ul>\n</blockquote>\n<h3 id=\"命令 -2\"><a href=\"# 命令 -2\" class=\"headerlink\" title=\"命令\"></a>命令</h3><blockquote>\n<p>jstat -gc 进程 pid 1000 10 </p>\n</blockquote>\n<h3 id=\"查看堆内存各部分的使用情况，百分比\"><a href=\"# 查看堆内存各部分的使用情况，百分比\" class=\"headerlink\" title=\"查看堆内存各部分的使用情况，百分比\"></a>查看堆内存各部分的使用情况，百分比 </h3><h3 id=\"命令 -3\"><a href=\"# 命令 -3\" class=\"headerlink\" title=\"命令\"></a> 命令</h3><blockquote>\n<p>jstat -gcutil 进程 pid 1000 10</p>\n</blockquote>\n<h3 id=\"类加载统计\"><a href=\"# 类加载统计\" class=\"headerlink\" title=\"类加载统计\"></a>类加载统计 </h3><h4 id=\"输出结果解释\"><a href=\"# 输出结果解释\" class=\"headerlink\" title=\"输出结果解释\"></a> 输出结果解释</h4><blockquote>\n<ul>\n<li>Loaded: 加载 class 的数量</li>\n<li>Bytes：所占用空间大小</li>\n<li>Unloaded：未加载数量</li>\n<li>Bytes: 未加载占用空间</li>\n<li>Time：时间</li>\n</ul>\n</blockquote>\n<h4 id=\"命令 -4\"><a href=\"# 命令 -4\" class=\"headerlink\" title=\"命令\"></a>命令</h4><blockquote>\n<ul>\n<li>jstat -class pid</li>\n</ul>\n</blockquote>\n<h1 id=\"MAT 可视化分析\"><a href=\"#MAT 可视化分析\" class=\"headerlink\" title=\"MAT 可视化分析\"></a>MAT 可视化分析</h1><h2 id=\"Histogram- 对象占用内存直方图\"><a href=\"#Histogram- 对象占用内存直方图\" class=\"headerlink\" title=\"Histogram 对象占用内存直方图\"></a>Histogram 对象占用内存直方图</h2><h2 id=\"Dominator-Tree 支配树\"><a href=\"#Dominator-Tree 支配树\" class=\"headerlink\" title=\"Dominator Tree 支配树\"></a>Dominator Tree 支配树</h2>","url":"/posts/45986/","min2read":1,"word4post":509,"prev_post":null,"next_post":{"title":"vue-knowledge","url":"/posts/52840/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"常见的线上 bug\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">常见的线上 bug</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"大对象\" href = \"#\"><span class=\"toc-number\">1.1.</span> <span class=\"toc-text\">大对象</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"内存泄漏\" href = \"#\"><span class=\"toc-number\">1.2.</span> <span class=\"toc-text\">内存泄漏</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"JVM 参数设置\" href = \"#\"><span class=\"toc-number\">1.3.</span> <span class=\"toc-text\">JVM 参数设置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"程序频繁生成一些长生命周期的对象\" href = \"#\"><span class=\"toc-number\">1.4.</span> <span class=\"toc-text\">程序频繁生成一些长生命周期的对象</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"JVM 参数\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">JVM 参数</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"JVM 命令\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\">JVM 命令 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"jmap\" href = \"#\"><span class=\"toc-number\">3.1.</span> <span class=\"toc-text\">jmap</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"下载 dump 文件\" href = \"#\"><span class=\"toc-number\">3.1.1.</span> <span class=\"toc-text\"> 下载 dump 文件 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" data-id=\"命令解释\" href = \"#\"><span class=\"toc-number\">3.1.1.1.</span> <span class=\"toc-text\"> 命令解释</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" data-id=\"命令\" href = \"#\"><span class=\"toc-number\">3.1.1.2.</span> <span class=\"toc-text\">命令</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"查看当前的活动对象\" href = \"#\"><span class=\"toc-number\">3.1.2.</span> <span class=\"toc-text\">查看当前的活动对象 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" data-id=\"命令解释 -1\" href = \"#\"><span class=\"toc-number\">3.1.2.1.</span> <span class=\"toc-text\"> 命令解释</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" data-id=\"命令 -1\" href = \"#\"><span class=\"toc-number\">3.1.2.2.</span> <span class=\"toc-text\">命令</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"jstat\" href = \"#\"><span class=\"toc-number\">3.2.</span> <span class=\"toc-text\">jstat</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"查看当前堆内存各部分的使用量\" href = \"#\"><span class=\"toc-number\">3.2.1.</span> <span class=\"toc-text\">查看当前堆内存各部分的使用量</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"命令 -2\" href = \"#\"><span class=\"toc-number\">3.2.2.</span> <span class=\"toc-text\">命令</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"查看堆内存各部分的使用情况，百分比\" href = \"#\"><span class=\"toc-number\">3.2.3.</span> <span class=\"toc-text\">查看堆内存各部分的使用情况，百分比 </span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"命令 -3\" href = \"#\"><span class=\"toc-number\">3.2.4.</span> <span class=\"toc-text\"> 命令</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"类加载统计\" href = \"#\"><span class=\"toc-number\">3.2.5.</span> <span class=\"toc-text\">类加载统计 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" data-id=\"输出结果解释\" href = \"#\"><span class=\"toc-number\">3.2.5.1.</span> <span class=\"toc-text\"> 输出结果解释</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" data-id=\"命令 -4\" href = \"#\"><span class=\"toc-number\">3.2.5.2.</span> <span class=\"toc-text\">命令</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"MAT 可视化分析\" href = \"#\"><span class=\"toc-number\">4.</span> <span class=\"toc-text\">MAT 可视化分析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"Histogram- 对象占用内存直方图\" href = \"#\"><span class=\"toc-number\">4.1.</span> <span class=\"toc-text\">Histogram 对象占用内存直方图</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"Dominator-Tree 支配树\" href = \"#\"><span class=\"toc-number\">4.2.</span> <span class=\"toc-text\">Dominator Tree 支配树</span></a></li></ol></li></ol>","categories":[{"name":"online","path":"api/categories/online.json","url":"/categories/online/"}],"tags":[]}