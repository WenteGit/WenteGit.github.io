{"title":"importantFunctions","slug":"AC-Functions","date":"2022-11-15","updated":"2023-02-07","comments":true,"path":"api/posts/30183.json","excerpt":"<blockquote><p> 对一些值得积累的函数、操作进行了积累 </p></blockquote>","cover":null,"covers":null,"content":"<blockquote>\n<p>对一些值得积累的函数、操作进行了积累</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"长整数加法器 -Java\"><a href=\"# 长整数加法器 -Java\" class=\"headerlink\" title=\"长整数加法器 Java\"></a>长整数加法器 Java</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 长整数加法器</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">addLongInteger</span><span class=\"params\">(String str, <span class=\"type\">int</span> num)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">ci</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">StringBuffer</span> <span class=\"variable\">sb</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuffer</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> str.length() -<span class=\"number\">1</span> ; i&gt;=<span class=\"number\">0</span> ;i--)&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">tempnum</span> <span class=\"operator\">=</span> (str.charAt(i) - <span class=\"number\">48</span>) + ci +num;</span><br><span class=\"line\">        ci = <span class=\"number\">0</span>;</span><br><span class=\"line\">        num = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (tempnum &gt;= <span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">            tempnum = tempnum %<span class=\"number\">10</span>;</span><br><span class=\"line\">            ci ++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        sb.append(String.valueOf(tempnum));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> sb.reverse().toString();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"文件上传操作\"><a href=\"# 文件上传操作\" class=\"headerlink\" title=\"文件上传操作\"></a>文件上传操作</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Wente</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2023/2/6</span></span><br><span class=\"line\"><span class=\"comment\"> * 和文件有关的操作</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/file&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FileController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;spring.servlet.multipart.location&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String fileSavePath;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;server.servlet.context-path&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String servletContextPath;</span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/upload&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">upload</span><span class=\"params\">(MultipartFile multipartFile, HttpServletRequest req)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1，保证本地的文件存储位</span></span><br><span class=\"line\">        <span class=\"type\">File</span> <span class=\"variable\">filefolder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(fileSavePath);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!filefolder.isDirectory())&#123;</span><br><span class=\"line\">            filefolder.mkdirs();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 2，文件重命名</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">returnUrlPath</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">oldName</span> <span class=\"operator\">=</span> multipartFile.getOriginalFilename();</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">newName</span> <span class=\"operator\">=</span> UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class=\"string\">&#x27;.&#x27;</span>),oldName.length());</span><br><span class=\"line\">            <span class=\"comment\">// 3，返回文件访问路径</span></span><br><span class=\"line\">            multipartFile.transferTo(<span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(filefolder,newName));</span><br><span class=\"line\">            returnUrlPath = req.getScheme() + <span class=\"string\">&quot;://&quot;</span> + req.getServerName() + <span class=\"string\">&quot;:&quot;</span> +</span><br><span class=\"line\">                    req.getServerPort() + servletContextPath +<span class=\"string\">&quot;/images/&quot;</span> + newName;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> JSON.toJSONString(ResultTool.failWithMessage(<span class=\"string\">&quot; 上传失败 &quot;</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JSON.toJSONString(ResultTool.successWithData(returnUrlPath));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"布隆过滤器\"><a href=\"# 布隆过滤器\" class=\"headerlink\" title=\"布隆过滤器\"></a>布隆过滤器 </h1><h2 id=\"依赖\"><a href=\"# 依赖\" class=\"headerlink\" title=\"依赖\"></a> 依赖</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-pool2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.guava<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>guava<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>30.1-jre<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"过滤器源码\"><a href=\"# 过滤器源码\" class=\"headerlink\" title=\"过滤器源码\"></a>过滤器源码</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Wente</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2023/2/7</span></span><br><span class=\"line\"><span class=\"comment\"> * 给 Redis 加上一层布隆过滤器</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisBloomFilter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * \t二进制位大小（多少位）</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long numBits ;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * \thash 函数个数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer numHashFunctions ;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Funnel&lt;CharSequence&gt; funnel = Funnels.stringFunnel(Charset.forName(<span class=\"string\">&quot;UTF-8&quot;</span>)) ;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> StringRedisTemplate stringRedisTemplate ;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;bf.expected-insertions&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long expectedInsertions;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;bf.fpp&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double fpp;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostConstruct</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initRedisBloomFilter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.numBits = optimalNumOfBits(expectedInsertions, fpp) ;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.numHashFunctions = optimalNumOfHashFunctions(expectedInsertions, numBits) ;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     *  \t最佳的位数（二进制位数）</span></span><br><span class=\"line\"><span class=\"comment\">     *  &lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     *  &lt;p&gt; 时间：2021 年 2 月 7 日 - 上午 10:13:43&lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span> xg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> expectedInsertions 预期插入的数量</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> fpp 错误率大于 0，小于 1.0</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> long</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">long</span> <span class=\"title function_\">optimalNumOfBits</span><span class=\"params\">(<span class=\"type\">long</span> expectedInsertions, <span class=\"type\">double</span> fpp)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (fpp == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            fpp = Double.MIN_VALUE;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"type\">long</span>) (-expectedInsertions * Math.log(fpp) / (Math.log(<span class=\"number\">2</span>) * Math.log(<span class=\"number\">2</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     *  \t最佳的 Hash 函数个数</span></span><br><span class=\"line\"><span class=\"comment\">     *  &lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     *  &lt;p&gt; 时间：2021 年 2 月 7 日 - 上午 10:17:26&lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span> xg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> expectedInsertions 预期插入的数量</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> numBits 根据 optimalNumOfBits 方法计算的最佳二进制位数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> int</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">optimalNumOfHashFunctions</span><span class=\"params\">(<span class=\"type\">long</span> expectedInsertions, <span class=\"type\">long</span> numBits)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Math.max(<span class=\"number\">1</span>, (<span class=\"type\">int</span>) Math.round((<span class=\"type\">double</span>) numBits / expectedInsertions * Math.log(<span class=\"number\">2</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/** 存数据 */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">put</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">byte</span>[] bytes = Hashing.murmur3_128().hashObject(value, funnel).asBytes();</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">hash1</span> <span class=\"operator\">=</span> lowerEight(bytes);</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">hash2</span> <span class=\"operator\">=</span> upperEight(bytes);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">bitsChanged</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">combinedHash</span> <span class=\"operator\">=</span> hash1;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; numHashFunctions; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">bit</span> <span class=\"operator\">=</span> (combinedHash &amp; Long.MAX_VALUE) % numBits ;</span><br><span class=\"line\">            <span class=\"comment\">// 这里设置对应的 bit 为 1</span></span><br><span class=\"line\">            stringRedisTemplate.opsForValue().setBit(key, bit, <span class=\"literal\">true</span>) ;</span><br><span class=\"line\">            combinedHash += hash2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bitsChanged;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/** 判断数据是否已经存在 */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">mightContain</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">byte</span>[] bytes = Hashing.murmur3_128().hashObject(value, funnel).asBytes();</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">hash1</span> <span class=\"operator\">=</span> lowerEight(bytes);</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">hash2</span> <span class=\"operator\">=</span> upperEight(bytes);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">combinedHash</span> <span class=\"operator\">=</span> hash1;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; numHashFunctions; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">bit</span> <span class=\"operator\">=</span> (combinedHash &amp; Long.MAX_VALUE) % numBits ;</span><br><span class=\"line\">            <span class=\"comment\">// 这里判断 redis 中对应位是否为 1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!stringRedisTemplate.opsForValue().getBit(key, bit)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            combinedHash += hash2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"title function_\">lowerEight</span><span class=\"params\">(<span class=\"type\">byte</span>[] bytes)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Longs.fromBytes(bytes[<span class=\"number\">7</span>], bytes[<span class=\"number\">6</span>], bytes[<span class=\"number\">5</span>], bytes[<span class=\"number\">4</span>], bytes[<span class=\"number\">3</span>], bytes[<span class=\"number\">2</span>], bytes[<span class=\"number\">1</span>], bytes[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"title function_\">upperEight</span><span class=\"params\">(<span class=\"type\">byte</span>[] bytes)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Longs.fromBytes(bytes[<span class=\"number\">15</span>], bytes[<span class=\"number\">14</span>], bytes[<span class=\"number\">13</span>], bytes[<span class=\"number\">12</span>], bytes[<span class=\"number\">11</span>], bytes[<span class=\"number\">10</span>], bytes[<span class=\"number\">9</span>], bytes[<span class=\"number\">8</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"相关配置\"><a href=\"# 相关配置\" class=\"headerlink\" title=\"相关配置\"></a>相关配置</h2><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">localhost</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> </span><br><span class=\"line\">    <span class=\"attr\">database:</span> <span class=\"number\">3</span> </span><br><span class=\"line\">    <span class=\"attr\">lettuce:</span></span><br><span class=\"line\">      <span class=\"attr\">pool:</span></span><br><span class=\"line\">        <span class=\"attr\">maxActive:</span> <span class=\"number\">8</span></span><br><span class=\"line\">        <span class=\"attr\">maxIdle:</span> <span class=\"number\">100</span></span><br><span class=\"line\">        <span class=\"attr\">minIdle:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">maxWait:</span> <span class=\"number\">-1</span></span><br><span class=\"line\"><span class=\"comment\"># 自定义相关的属性配置          </span></span><br><span class=\"line\"><span class=\"attr\">bf:</span></span><br><span class=\"line\">  <span class=\"attr\">expected-insertions:</span> <span class=\"number\">10001</span></span><br><span class=\"line\">  <span class=\"attr\">fpp:</span> <span class=\"number\">0.01</span>     </span><br></pre></td></tr></table></figure>","url":"/posts/30183/","min2read":5,"word4post":908,"prev_post":{"title":"sql-DCL","url":"/posts/37793/"},"next_post":{"title":"JavaIO","url":"/posts/20622/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"长整数加法器 -Java\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">长整数加法器 Java</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"文件上传操作\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">文件上传操作</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"布隆过滤器\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\">布隆过滤器 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"依赖\" href = \"#\"><span class=\"toc-number\">3.1.</span> <span class=\"toc-text\"> 依赖</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"过滤器源码\" href = \"#\"><span class=\"toc-number\">3.2.</span> <span class=\"toc-text\">过滤器源码</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"相关配置\" href = \"#\"><span class=\"toc-number\">3.3.</span> <span class=\"toc-text\">相关配置</span></a></li></ol></li></ol>","categories":[{"name":"Accumulate","path":"api/categories/Accumulate.json","url":"/categories/Accumulate/"}],"tags":[{"name":"Functions","path":"api/tags/Functions.json","url":"/tags/Functions/"}]}