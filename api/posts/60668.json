{"title":"Sentinel","slug":"Cloud-Alibaba-Sentinel","date":"2022-07-28","updated":"2023-02-23","comments":true,"path":"api/posts/60668.json","excerpt":"<blockquote><p> 总结了 Sentinel 服务降级、服务熔断的有关知识 </p></blockquote>","cover":"http://xtzl.wentexl.cn/PostMan.png","covers":["http://xtzl.wentexl.cn/PostMan.png","http://xtzl.wentexl.cn/%E5%85%B3%E8%81%94.png","http://xtzl.wentexl.cn/%E5%AE%98%E7%BD%91%E7%86%94%E6%96%AD.png","http://xtzl.wentexl.cn/%E6%85%A2%E6%AF%94%E4%BE%8B1.png","http://xtzl.wentexl.cn/%E5%BC%82%E5%B8%B8%E6%AF%94%E4%BE%8B1.8.4.png","http://xtzl.wentexl.cn/%E5%BC%82%E5%B8%B8%E6%95%B01.8.4.png","http://xtzl.wentexl.cn/%E5%8F%82%E6%95%B0%E4%BE%8B%E5%A4%96.png","http://xtzl.wentexl.cn/json.png"],"content":"<blockquote>\n<p>总结了 Sentinel 服务降级、服务熔断的有关知识</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"重点\"><a href=\"# 重点\" class=\"headerlink\" title=\"重点\"></a>重点</h1><blockquote>\n<ul>\n<li>实例重启后如果进入 sentinel 的 web 界面，则必须先调用一个任意的方法才能被检测到</li>\n<li>fallback 管的是运行异常，blockHandler 管的是配置违规</li>\n<li>当 fallback 和 blockHandler 同时起效的时，优先起效的是 blockHandler 方法</li>\n<li>自带负载均衡</li>\n</ul>\n</blockquote>\n<h1 id=\"依赖引入\"><a href=\"# 依赖引入\" class=\"headerlink\" title=\"依赖引入\"></a>依赖引入</h1><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos 后续 sentinel 做持久化用到 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--SpringCloud ailibaba sentinel --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"服务端 -yml- 配置\"><a href=\"# 服务端 -yml- 配置\" class=\"headerlink\" title=\"服务端 yml 配置\"></a>服务端 yml 配置</h1><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8401</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">cloudalibaba-sentinel-service</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"string\">localhost:8848</span> <span class=\"comment\">#Nacos 服务注册中心地址</span></span><br><span class=\"line\">    <span class=\"attr\">sentinel:</span></span><br><span class=\"line\">      <span class=\"attr\">transport:</span></span><br><span class=\"line\">        <span class=\"comment\"># 8080 会监控 8401 查看是否健康</span></span><br><span class=\"line\">        <span class=\"attr\">dashboard:</span> <span class=\"string\">localhost:8080</span> <span class=\"comment\"># 配置 Sentinel dashboard 地址</span></span><br><span class=\"line\">        <span class=\"comment\"># 默认是 8719 端口号, 如果被占用了会自动 +1</span></span><br><span class=\"line\">        <span class=\"comment\"># 指定应用与 Sentinel 控制台交互的端口，应用本地会起一个该端口占用的 HttpServer</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span> <span class=\"number\">8719</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"attr\">datasource:</span></span><br><span class=\"line\">        <span class=\"attr\">ds1:</span></span><br><span class=\"line\">          <span class=\"attr\">nacos:</span></span><br><span class=\"line\">            <span class=\"attr\">server-addr:</span> <span class=\"string\">localhost:8848</span></span><br><span class=\"line\">            <span class=\"attr\">dataId:</span> <span class=\"string\">$&#123;spring.application.name&#125;</span></span><br><span class=\"line\">            <span class=\"attr\">groupId:</span> <span class=\"string\">DEFAULT_GROUP</span></span><br><span class=\"line\">            <span class=\"attr\">data-type:</span> <span class=\"string\">json</span></span><br><span class=\"line\">            <span class=\"attr\">rule-type:</span> <span class=\"string\">flow</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoints:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"attr\">include:</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"流控规则\"><a href=\"# 流控规则\" class=\"headerlink\" title=\"流控规则\"></a>流控规则</h1><blockquote>\n<ul>\n<li>QPS: 每秒的请求数，一般指每秒查询率</li>\n<li>单机阈值: 请求数的多少</li>\n</ul>\n</blockquote>\n<h2 id=\"PostMan 测试\"><a href=\"#PostMan 测试\" class=\"headerlink\" title=\"PostMan 测试\"></a>PostMan 测试</h2><p><img src=\"http://xtzl.wentexl.cn/PostMan.png\" alt=\"postman\"></p>\n<h2 id=\"流控效果\"><a href=\"# 流控效果\" class=\"headerlink\" title=\"流控效果\"></a>流控效果 </h2><h3 id=\"预热\"><a href=\"# 预热\" class=\"headerlink\" title=\"预热\"></a> 预热</h3><blockquote>\n<ul>\n<li>ColdFactor 冷加载因子默认是 3</li>\n<li>请求 QPS 从 threshold/3 开始，经预热时长之后，QPS 才会逐渐达到指定 QPS 值</li>\n<li>预热主要是为了保护系统</li>\n</ul>\n</blockquote>\n<h3 id=\"快速失败\"><a href=\"# 快速失败\" class=\"headerlink\" title=\"快速失败\"></a>快速失败</h3><blockquote>\n<ul>\n<li>只要不满足流控规则，直接让该请求失败</li>\n</ul>\n</blockquote>\n<h3 id=\"排队等等\"><a href=\"# 排队等等\" class=\"headerlink\" title=\"排队等等\"></a>排队等等</h3><blockquote>\n<ul>\n<li>只要每个请求的等待时间不超过设定的超时时间，则每个请求都排队等待响应</li>\n<li>而处理的速度，根据流控规则的单机阈值来决定</li>\n<li>其中超时时间的单位是 ms</li>\n<li>如果请求超时，则报错</li>\n</ul>\n</blockquote>\n<h2 id=\"流控模式\"><a href=\"# 流控模式\" class=\"headerlink\" title=\"流控模式\"></a>流控模式 </h2><h3 id=\"关联\"><a href=\"# 关联\" class=\"headerlink\" title=\"关联\"></a> 关联</h3><p><img src=\"http://xtzl.wentexl.cn/%E5%85%B3%E8%81%94.png\" alt=\"connect\"></p>\n<h3 id=\"直接\"><a href=\"# 直接\" class=\"headerlink\" title=\"直接\"></a>直接</h3><blockquote>\n<ul>\n<li>仅仅针对于一个方法而言</li>\n</ul>\n</blockquote>\n<h1 id=\"降级与熔断策略\"><a href=\"# 降级与熔断策略\" class=\"headerlink\" title=\"降级与熔断策略\"></a>降级与熔断策略</h1><blockquote>\n<ul>\n<li>官网讲解<br><img src=\"http://xtzl.wentexl.cn/%E5%AE%98%E7%BD%91%E7%86%94%E6%96%AD.png\" alt=\"熔断\"></li>\n</ul>\n</blockquote>\n<h2 id=\"RT- 慢调用比例\"><a href=\"#RT- 慢调用比例\" class=\"headerlink\" title=\"RT: 慢调用比例\"></a>RT: 慢调用比例</h2><blockquote>\n<ul>\n<li>注意：Sentinel 默认 RT 最大时间为 4900 毫秒，可通过 -Dcsp.sentinel.statistic.max.rt=xxx 修改  </li>\n<li>慢调用比例 = 慢调用请求数 / 请求总数</li>\n<li>在单位统计时长内，如果慢调用比例大于阈值，且请求数大于最小请求数值，则触发熔断</li>\n<li>经过一个熔断时长后，进入探测恢复状态（HALF-OPEN）阶段，即接下来的一个请求响应时间小于 rt(200ms), 则熔断结束，否则会再次被熔断。</li>\n<li>慢调用不是异常，如果异常的话是不会进行服务降级而是直接报错<br><img src=\"http://xtzl.wentexl.cn/%E6%85%A2%E6%AF%94%E4%BE%8B1.png\" alt=\"慢比例\"></li>\n</ul>\n</blockquote>\n<blockquote>\n<hr>\n</blockquote>\n<h2 id=\"异常比例\"><a href=\"# 异常比例\" class=\"headerlink\" title=\"异常比例\"></a>异常比例</h2><blockquote>\n<ul>\n<li>当单位统计时长内，请求数目大于设置的最小请求数目（5），并且异常的比例大于阈值（0.07），则接下来的熔断时长（3s，时间窗口的值）内请求会自动被熔断。  </li>\n<li>经过熔断时长后熔断器会进入探测恢复状态（HALF-OPEN 状态），若接下来的一个请求成功完成（没有错误）则结束熔断，否则会再次被熔断。异常比率的阈值范围是 [0.0, 1.0]。<br><img src=\"http://xtzl.wentexl.cn/%E5%BC%82%E5%B8%B8%E6%AF%94%E4%BE%8B1.8.4.png\" alt=\"异常\"></li>\n</ul>\n</blockquote>\n<blockquote>\n<hr>\n</blockquote>\n<h2 id=\"异常数\"><a href=\"# 异常数\" class=\"headerlink\" title=\"异常数\"></a>异常数</h2><blockquote>\n<ul>\n<li>异常数一般都是按分钟统计的</li>\n<li>单位统计时长内，异常数达到设定的异常数则进入服务熔断，调用服务降级的函数</li>\n<li>服务熔断之后，经过一个熔断时长之后，才会进入探测恢复状态<br><img src=\"http://xtzl.wentexl.cn/%E5%BC%82%E5%B8%B8%E6%95%B01.8.4.png\" alt=\"异常数\"></li>\n</ul>\n</blockquote>\n<h1 id=\"热点监控\"><a href=\"# 热点监控\" class=\"headerlink\" title=\"热点监控\"></a>热点监控</h1><blockquote>\n<ul>\n<li>在 web 界面自定义热点规则，当请求违背了热点规则之后，则执行 blocakHandler 所指的的方法</li>\n<li>@SentinelResource 的 value 属性只要保持唯一性就好，一般与 GetMapping 的 value 保持一致</li>\n<li>运行异常不属于热点监控的范围，热点监控只管是否违背热点规则，运行异常也就不会走 blockHandler 这个方法</li>\n</ul>\n</blockquote>\n<h2 id=\"Controller 层\"><a href=\"#Controller 层\" class=\"headerlink\" title=\"Controller 层\"></a>Controller 层</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/testHotKey&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@SentinelResource(value = &quot;testHotKey&quot;, blockHandler = &quot;deal_testHotKey&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">testHotKey</span><span class=\"params\">(<span class=\"meta\">@RequestParam(value = &quot;p1&quot;, required = false)</span> String p1,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@RequestParam(value = &quot;p2&quot;, required = false)</span> String p2)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">age</span> <span class=\"operator\">=</span> <span class=\"number\">10</span> / <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;------testHotKey&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 兜底的方法</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">deal_testHotKey</span><span class=\"params\">(String p1, String p2, BlockException exception)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//sentinel 系统默认的提示：Blocked by Sentinel (flow limiting)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;------deal_testHotKey,o(╥﹏╥)o&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Web 界面配置\"><a href=\"#Web 界面配置\" class=\"headerlink\" title=\"Web 界面配置\"></a>Web 界面配置</h2><blockquote>\n<ul>\n<li>该图表示监控携带第 0 个参数的请求，窗口时长内的请求数不能超过 1 次，资源名为 @SentinelResource 的 Value 值</li>\n<li>参数例外项：当指定参数为一特定值的时候，阈值有所不同<br><img src=\"http://xtzl.wentexl.cn/%E5%8F%82%E6%95%B0%E4%BE%8B%E5%A4%96.png\" alt=\"热点规则\"></li>\n</ul>\n</blockquote>\n<h1 id=\"Sentinel- 自定义限流处理逻辑\"><a href=\"#Sentinel- 自定义限流处理逻辑\" class=\"headerlink\" title=\"Sentinel 自定义限流处理逻辑\"></a>Sentinel 自定义限流处理逻辑</h1><blockquote>\n<ul>\n<li>违反我们自己配置的流控规则才需要 blockHandler</li>\n<li>在配置流控规则的时候，资源标识最好只使用 @SentinelResource 注解的 Value 属性作为唯一标识</li>\n</ul>\n</blockquote>\n<h2 id=\"SentinelResource\"><a href=\"#SentinelResource\" class=\"headerlink\" title=\"@SentinelResource\"></a>@SentinelResource</h2><blockquote>\n<hr>\n<ul>\n<li>(value = “byResource”,blockHandler = “handleException”)</li>\n<li>value 是唯一标识，blockHandler 是指定处理方法 (兜底方法) 的方法名</li>\n</ul>\n<hr>\n<ul>\n<li>(value = “customerBlockHandler”,<br>blockHandlerClass = CustomerBlockHandler.class, blockHandler = “handlerException2”)</li>\n<li>blockHandlerClass 指定处理类，blockHandler 指定类中的哪个方法</li>\n<li>注意在写 Handler 类的方法的时候，所有方法都必须是 static 的，且 handler 类无须加入容器</li>\n</ul>\n<hr>\n<ul>\n<li>其中属性 exceptionsToIgnore = {IllegalArgumentException.class}，表示忽略 IllegalArgumentException 这个异常属性，但是这个忽略异常属性，仅仅指的是在 Java 层面，也就是 fallback 方法不响应该异常，但是 Sentinel 仍然会检测到该异常</li>\n</ul>\n</blockquote>\n<h1 id=\"Sentinele 同样支持 Open-feign\"><a href=\"#Sentinele 同样支持 Open-feign\" class=\"headerlink\" title=\"Sentinele 同样支持 Open-feign\"></a>Sentinele 同样支持 Open-feign</h1><blockquote>\n<p>修改 yml 支持 Open-feign<br> <figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># 激活 Sentinel 对 Feign 的支持</span></span><br><span class=\"line\"><span class=\"attr\">feign:</span></span><br><span class=\"line\">  <span class=\"attr\">sentinel:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@FeignClient(value = &quot;nacos-payment-provider&quot;, fallback = PaymentFallbackService.class)</span></span><br></pre></td></tr></table></figure>\n<p>其中，service 层分为接口 + 实现类，上面的注解标注在接口，fallback 指向实现类</p>\n</blockquote>\n<h1 id=\"Sentinel 持久化\"><a href=\"#Sentinel 持久化\" class=\"headerlink\" title=\"Sentinel 持久化\"></a>Sentinel 持久化 </h1><h2 id=\"依赖引入 -1\"><a href=\"# 依赖引入 -1\" class=\"headerlink\" title=\"依赖引入\"></a> 依赖引入</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"YML 配置\"><a href=\"#YML 配置\" class=\"headerlink\" title=\"YML 配置\"></a>YML 配置</h2><blockquote>\n<p>将 Sentinel 配置进 Nacos 中</p>\n</blockquote>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">     <span class=\"attr\">sentinel:</span> </span><br><span class=\"line\">        <span class=\"attr\">datasource:</span></span><br><span class=\"line\">          <span class=\"attr\">ds1:</span></span><br><span class=\"line\">            <span class=\"attr\">nacos:</span></span><br><span class=\"line\">              <span class=\"attr\">server-addr:</span> <span class=\"string\">localhost:8848</span></span><br><span class=\"line\">              <span class=\"attr\">dataId:</span> <span class=\"string\">$&#123;spring.application.name&#125;</span></span><br><span class=\"line\">              <span class=\"attr\">groupId:</span> <span class=\"string\">DEFAULT_GROUP</span></span><br><span class=\"line\">              <span class=\"attr\">data-type:</span> <span class=\"string\">json</span></span><br><span class=\"line\">              <span class=\"attr\">rule-type:</span> <span class=\"string\">flow</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>需要手动写进 Nacos</p>\n<ul>\n<li>在 Nacos 中需要新建一个配置文件 s</li>\n<li>配置文件名 DataId 就是 Sentinel 的实例服务名</li>\n<li>配置文件的内容是 Json 格式</li>\n</ul>\n</blockquote>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;resource&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/rateLimit/byUrl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;limitApp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;default&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;grade&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;strategy&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;controlBehavior&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;clusterMode&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n<p><strong>解释如下:</strong><br><img src=\"http://xtzl.wentexl.cn/json.png\" alt=\"json\"></p>\n","url":"/posts/60668/","min2read":6,"word4post":"1.6k","prev_post":{"title":"Nacos","url":"/posts/33695/"},"next_post":{"title":"MQ-Notes","url":"/posts/44276/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"重点\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">重点</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"依赖引入\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">依赖引入</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"服务端 -yml- 配置\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\">服务端 yml 配置</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"流控规则\" href = \"#\"><span class=\"toc-number\">4.</span> <span class=\"toc-text\">流控规则</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"PostMan 测试\" href = \"#\"><span class=\"toc-number\">4.1.</span> <span class=\"toc-text\">PostMan 测试</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"流控效果\" href = \"#\"><span class=\"toc-number\">4.2.</span> <span class=\"toc-text\">流控效果 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"预热\" href = \"#\"><span class=\"toc-number\">4.2.1.</span> <span class=\"toc-text\"> 预热</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"快速失败\" href = \"#\"><span class=\"toc-number\">4.2.2.</span> <span class=\"toc-text\">快速失败</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"排队等等\" href = \"#\"><span class=\"toc-number\">4.2.3.</span> <span class=\"toc-text\">排队等等</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"流控模式\" href = \"#\"><span class=\"toc-number\">4.3.</span> <span class=\"toc-text\">流控模式 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"关联\" href = \"#\"><span class=\"toc-number\">4.3.1.</span> <span class=\"toc-text\"> 关联</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"直接\" href = \"#\"><span class=\"toc-number\">4.3.2.</span> <span class=\"toc-text\">直接</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"降级与熔断策略\" href = \"#\"><span class=\"toc-number\">5.</span> <span class=\"toc-text\">降级与熔断策略</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"RT- 慢调用比例\" href = \"#\"><span class=\"toc-number\">5.1.</span> <span class=\"toc-text\">RT: 慢调用比例</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"异常比例\" href = \"#\"><span class=\"toc-number\">5.2.</span> <span class=\"toc-text\">异常比例</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"异常数\" href = \"#\"><span class=\"toc-number\">5.3.</span> <span class=\"toc-text\">异常数</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"热点监控\" href = \"#\"><span class=\"toc-number\">6.</span> <span class=\"toc-text\">热点监控</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"Controller 层\" href = \"#\"><span class=\"toc-number\">6.1.</span> <span class=\"toc-text\">Controller 层</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"Web 界面配置\" href = \"#\"><span class=\"toc-number\">6.2.</span> <span class=\"toc-text\">Web 界面配置</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Sentinel- 自定义限流处理逻辑\" href = \"#\"><span class=\"toc-number\">7.</span> <span class=\"toc-text\">Sentinel 自定义限流处理逻辑</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"SentinelResource\" href = \"#\"><span class=\"toc-number\">7.1.</span> <span class=\"toc-text\">@SentinelResource</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Sentinele 同样支持 Open-feign\" href = \"#\"><span class=\"toc-number\">8.</span> <span class=\"toc-text\">Sentinele 同样支持 Open-feign</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Sentinel 持久化\" href = \"#\"><span class=\"toc-number\">9.</span> <span class=\"toc-text\">Sentinel 持久化 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"依赖引入 -1\" href = \"#\"><span class=\"toc-number\">9.1.</span> <span class=\"toc-text\"> 依赖引入</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"YML 配置\" href = \"#\"><span class=\"toc-number\">9.2.</span> <span class=\"toc-text\">YML 配置</span></a></li></ol></li></ol>","categories":[{"name":"SpringCloudAlibaba","path":"api/categories/SpringCloudAlibaba.json","url":"/categories/SpringCloudAlibaba/"}],"tags":[{"name":"Sentinel","path":"api/tags/Sentinel.json","url":"/tags/Sentinel/"}]}