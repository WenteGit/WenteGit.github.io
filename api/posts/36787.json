{"title":"TechStack-Hikari","slug":"TechStack-Hikari","date":"2022-12-07","updated":"2022-12-08","comments":true,"path":"api/posts/36787.json","excerpt":"<blockquote><p> 总结了关于 Hikari 数据库连接池的相关信息与内容 </p></blockquote>","cover":null,"covers":null,"content":"<blockquote>\n<p> 总结了关于 Hikari 数据库连接池的相关信息与内容 </p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"引入依赖\"><a href=\"# 引入依赖\" class=\"headerlink\" title=\"引入依赖\"></a> 引入依赖 </h1><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.zaxxer<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>HikariCP<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"dataSource\"><a href=\"#dataSource\" class=\"headerlink\" title=\"dataSource\"></a>dataSource</h1><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">datasource:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"基本配置及其解释\"><a href=\"# 基本配置及其解释\" class=\"headerlink\" title=\"基本配置及其解释\"></a> 基本配置及其解释 </h1><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">hikari:</span></span><br><span class=\"line\">    <span class=\"comment\"># 控制 HikariCP 尝试在池中维护的最小空闲连接数 </span></span><br><span class=\"line\">    <span class=\"attr\">minimum-idle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"comment\"># 控制允许连接在池中保持空闲状态的最长时间, 这里是 10min</span></span><br><span class=\"line\">    <span class=\"attr\">idle-timeout:</span> <span class=\"number\">600000</span></span><br><span class=\"line\">    <span class=\"comment\"># 控制允许池达到的最大大小, 同时最多允许十个连接 </span></span><br><span class=\"line\">    <span class=\"attr\">maximum-pool-size:</span> <span class=\"number\">10</span></span><br><span class=\"line\">    <span class=\"comment\"># 自动提交行为 </span></span><br><span class=\"line\">    <span class=\"attr\">auto-commit:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\"># 表示连接池的用户定义名称 </span></span><br><span class=\"line\">    <span class=\"attr\">pool-name:</span> <span class=\"string\">MyHikariCP</span></span><br><span class=\"line\">    <span class=\"comment\"># 控制池中连接的最大生存期 </span></span><br><span class=\"line\">    <span class=\"attr\">max-lifetime:</span> <span class=\"number\">1800000</span></span><br><span class=\"line\">    <span class=\"comment\"># 控制客户端等待来自池的连接的最大毫秒数 </span></span><br><span class=\"line\">    <span class=\"attr\">connection-timeout:</span> <span class=\"number\">30000</span></span><br><span class=\"line\">    <span class=\"comment\"># 测试数据库连接的语句 </span></span><br><span class=\"line\">    <span class=\"attr\">connection-test-query:</span> <span class=\"string\">SELECT</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"配置详解\"><a href=\"# 配置详解\" class=\"headerlink\" title=\"配置详解\"></a> 配置详解 </h1><h2 id=\"autoCommit\"><a href=\"#autoCommit\" class=\"headerlink\" title=\"autoCommit\"></a>autoCommit</h2><pre><code>    此属性控制从池返回的连接的默认自动提交行为。它是一个布尔值。 默认值：true\n</code></pre>\n<h2 id=\"connectionTimeout\"><a href=\"#connectionTimeout\" class=\"headerlink\" title=\"connectionTimeout\"></a>connectionTimeout</h2><pre><code>    此属性控制客户端（即您）等待来自池的连接的最大毫秒数。如果超过此时间而没有可用的连接，则会抛出 SQLException。可接受的最低连接超时为 250 ms。 默认值：30000（30 秒）\n</code></pre>\n<h2 id=\"idleTimeout\"><a href=\"#idleTimeout\" class=\"headerlink\" title=\"idleTimeout\"></a>idleTimeout</h2><pre><code>    此属性控制允许连接在池中保持空闲状态的最长时间。 仅当 minimumIdle 定义为小于 maximumPoolSize 时，此设置才适用。连接池达到连接后， 空闲连接将不会退出 minimumIdle。连接是否以空闲状态退役，最大变化为 +30 秒，平均变化为 +15 秒。在此超时之前，连接永远不会因为闲置而退役。值必须比 maxLifetime 小。值为 0 表示永远不会从池中删除空闲连接。最小允许值为 10000ms（10 秒）。 默认值：600000（10 分钟）\n</code></pre>\n<h2 id=\"maxLifetime\"><a href=\"#maxLifetime\" class=\"headerlink\" title=\"maxLifetime\"></a>maxLifetime</h2><pre><code>    此属性控制池中连接的最大生存期。使用中的连接永远不会停止使用，只有在关闭连接后才将其删除。在逐个连接的基础上，应用较小的负衰减以避免池中的质量消灭。 我们强烈建议设置此值，它应该比任何数据库或基础结构施加的连接时间限制短几秒钟。 值 0 表示没有最大寿命（无限寿命），当然要遵守该 idleTimeout 设置。最小允许值为 30000ms（30 秒）。 默认值：1800000（30 分钟）\n</code></pre>\n<h2 id=\"connectionTestQuery\"><a href=\"#connectionTestQuery\" class=\"headerlink\" title=\"connectionTestQuery\"></a>connectionTestQuery</h2><pre><code>    如果您的驱动程序支持 JDBC4，我们强烈建议不要设置此属性。这是针对不支持 JDBC4 的“旧版”驱动程序的 Connection.isValid() API。这是将在从池中为您提供连接之前执行的查询，以验证与数据库的连接仍然有效。同样，尝试运行不带该属性的池，如果驱动程序不兼容 JDBC4，HikariCP 将记录错误。 默认值：无\n</code></pre>\n<h2 id=\"minimumIdle\"><a href=\"#minimumIdle\" class=\"headerlink\" title=\"minimumIdle\"></a>minimumIdle</h2><pre><code>    此属性控制 HikariCP 尝试在池中维护的最小空闲连接数。如果空闲连接下降到该值以下，并且池中的总连接数少于 maximumPoolSize，则 HikariCP 将尽最大努力快速而有效地添加其他连接。但是，为了获得最佳性能和对峰值需求的响应能力，我们建议不要设置此值，而应让 HikariCP 充当固定大小的连接池。 默认值：与 maximumPoolSize 相同\n</code></pre>\n<h2 id=\"maximumPoolSize\"><a href=\"#maximumPoolSize\" class=\"headerlink\" title=\"maximumPoolSize\"></a>maximumPoolSize</h2><pre><code>    此属性控制允许池达到的最大大小，包括空闲和使用中的连接。基本上，此值将确定到数据库后端的最大实际连接数。合理的值最好由您的执行环境确定。当池达到此大小并且没有空闲连接可用时，对 getConnection（）的调用将 connectionTimeout 在超时之前最多阻塞毫秒。请阅读有关池大小的信息。 默认值：10\n</code></pre>\n<h2 id=\"metricRegistry\"><a href=\"#metricRegistry\" class=\"headerlink\" title=\"metricRegistry\"></a>metricRegistry</h2><pre><code>    此属性仅可通过编程配置或 IoC 容器使用。此属性允许您指定池将用于记录各种指标的 Codahale / Dropwizard 的实例 MetricRegistry。有关 详细信息，请参见 Metrics Wiki 页面。 默认值：无\n</code></pre>\n<h2 id=\"healthCheckRegistry\"><a href=\"#healthCheckRegistry\" class=\"headerlink\" title=\"healthCheckRegistry\"></a>healthCheckRegistry</h2><pre><code>    此属性仅可通过编程配置或 IoC 容器使用。此属性允许您指定池将用于报告当前健康信息的 Codahale / Dropwizard 的实例 HealthCheckRegistry。有关 详细信息，请参见运行状况检查 Wiki 页面。 默认值：无\n</code></pre>\n<h2 id=\"poolName\"><a href=\"#poolName\" class=\"headerlink\" title=\"poolName\"></a>poolName</h2><pre><code>    该属性表示连接池的用户定义名称，主要出现在日志记录和 JMX 管理控制台中，以识别池和池配置。 默认值：自动生成\n</code></pre>\n","url":"/posts/36787/","min2read":4,"word4post":"1.1k","prev_post":{"title":"Python","url":"/posts/43687/"},"next_post":{"title":"official_document","url":"/posts/9625/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"引入依赖\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\"> 引入依赖 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"dataSource\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">dataSource</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"基本配置及其解释\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\"> 基本配置及其解释 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"配置详解\" href = \"#\"><span class=\"toc-number\">4.</span> <span class=\"toc-text\"> 配置详解 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"autoCommit\" href = \"#\"><span class=\"toc-number\">4.1.</span> <span class=\"toc-text\">autoCommit</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"connectionTimeout\" href = \"#\"><span class=\"toc-number\">4.2.</span> <span class=\"toc-text\">connectionTimeout</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"idleTimeout\" href = \"#\"><span class=\"toc-number\">4.3.</span> <span class=\"toc-text\">idleTimeout</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"maxLifetime\" href = \"#\"><span class=\"toc-number\">4.4.</span> <span class=\"toc-text\">maxLifetime</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"connectionTestQuery\" href = \"#\"><span class=\"toc-number\">4.5.</span> <span class=\"toc-text\">connectionTestQuery</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"minimumIdle\" href = \"#\"><span class=\"toc-number\">4.6.</span> <span class=\"toc-text\">minimumIdle</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"maximumPoolSize\" href = \"#\"><span class=\"toc-number\">4.7.</span> <span class=\"toc-text\">maximumPoolSize</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"metricRegistry\" href = \"#\"><span class=\"toc-number\">4.8.</span> <span class=\"toc-text\">metricRegistry</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"healthCheckRegistry\" href = \"#\"><span class=\"toc-number\">4.9.</span> <span class=\"toc-text\">healthCheckRegistry</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"poolName\" href = \"#\"><span class=\"toc-number\">4.10.</span> <span class=\"toc-text\">poolName</span></a></li></ol></li></ol>","categories":[{"name":"TechStack","path":"api/categories/TechStack.json","url":"/categories/TechStack/"}],"tags":[{"name":"Hikari","path":"api/tags/Hikari.json","url":"/tags/Hikari/"}]}