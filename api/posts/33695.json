{"title":"Cloud-Alibaba-Nacos","slug":"Cloud-Alibaba-Nacos","date":"2022-07-28","updated":"2022-08-19","comments":true,"path":"api/posts/33695.json","excerpt":"<blockquote><p> 总结了关于 SpringCloud-Alibaba-Nacos 的相关知识 </p></blockquote>","cover":"http://xtzl.wentexl.cn/%E5%88%86%E7%BB%84%E7%AE%A1%E7%90%86.png","covers":["http://xtzl.wentexl.cn/%E5%88%86%E7%BB%84%E7%AE%A1%E7%90%86.png"],"content":"<blockquote>\n<p>总结了关于 SpringCloud-Alibaba-Nacos 的相关知识</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h1><blockquote>\n<ul>\n<li>Nacos 就是注册中心 + 配置中心的组合</li>\n<li>等价于 Nacos = Eureka + Config + Bus</li>\n<li>AP 架构和 CP 架构都支持，可切换（C: 一致性 A：可用性  P: 分区容错性）</li>\n<li>startup.cmd -m standalone  单机启动命令</li>\n</ul>\n</blockquote>\n<h1 id=\"依赖引入\"><a href=\"# 依赖引入\" class=\"headerlink\" title=\"依赖引入\"></a>依赖引入</h1><blockquote>\n<p>父工程 pom：</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>子工程 pom：</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Nacos 注册中心\"><a href=\"#Nacos 注册中心\" class=\"headerlink\" title=\"Nacos 注册中心\"></a>Nacos 注册中心 </h1><h2 id=\"服务端 Yml 配置\"><a href=\"# 服务端 Yml 配置\" class=\"headerlink\" title=\"服务端 Yml 配置\"></a> 服务端 Yml 配置</h2><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">9002</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nacos-payment-provider</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"string\">localhost:8848</span> <span class=\"comment\"># 配置 Nacos 地址</span></span><br><span class=\"line\">        <span class=\"comment\"># 换成 nginx 的 1111 端口，做集群</span></span><br><span class=\"line\">        <span class=\"comment\">#server-addr: 192.168.111.144:1111</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoints:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"attr\">include:</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"客户端 Yml 配置\"><a href=\"# 客户端 Yml 配置\" class=\"headerlink\" title=\"客户端 Yml 配置\"></a>客户端 Yml 配置</h2><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">83</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nacos-order-consumer</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"string\">localhost:8848</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">service-url:</span></span><br><span class=\"line\">  <span class=\"attr\">nacos-user-service:</span> <span class=\"string\">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"客户端 Controller 层\"><a href=\"# 客户端 Controller 层\" class=\"headerlink\" title=\"客户端 Controller 层\"></a>客户端 Controller 层</h2><blockquote>\n<p>由于在配置 yml 的时候，已经在 service-url.nacos-user-service 中配置过了，所以直接可用 @Value 注解进行引入</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Value(&quot;$&#123;service-url.nacos-user-service&#125;&quot;)</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> String serverURL;</span><br></pre></td></tr></table></figure>\n<h1 id=\"Nacos- 配置中心\"><a href=\"#Nacos- 配置中心\" class=\"headerlink\" title=\"Nacos 配置中心\"></a>Nacos 配置中心 </h1><h2 id=\"核心\"><a href=\"# 核心\" class=\"headerlink\" title=\"核心\"></a> 核心</h2><blockquote>\n<ul>\n<li>Nacos 的 Config 配置自带动态刷新</li>\n<li>DataId 必须按官方给定的格式命名</li>\n</ul>\n</blockquote>\n<h2 id=\"新增依赖\"><a href=\"# 新增依赖\" class=\"headerlink\" title=\"新增依赖\"></a>新增依赖</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"yml 配置\"><a href=\"#yml 配置\" class=\"headerlink\" title=\"yml 配置\"></a>yml 配置</h2><blockquote>\n<p><strong>bootstrap 的优先级是高于 application 的</strong></p>\n</blockquote>\n<blockquote>\n<p>bootstrap.yml</p>\n</blockquote>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">3377</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nacos-config-client</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"string\">localhost:8848</span> <span class=\"comment\"># 服务注册中心地址</span></span><br><span class=\"line\">      <span class=\"attr\">config:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"string\">localhost:8848</span> <span class=\"comment\"># 配置中心地址</span></span><br><span class=\"line\">        <span class=\"attr\">file-extension:</span> <span class=\"string\">yaml</span> <span class=\"comment\"># 指定 yaml 格式的配置</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>application.yml</p>\n</blockquote>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">active:</span> <span class=\"string\">dev</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"在 Nacos 端的配置文件名格式如下 - 设置 DataId\"><a href=\"# 在 Nacos 端的配置文件名格式如下 - 设置 DataId\" class=\"headerlink\" title=\"在 Nacos 端的配置文件名格式如下 (设置 DataId):\"></a> 在 Nacos 端的配置文件名格式如下(设置 DataId):</h2><blockquote>\n<p>${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}<br>例如: nacos-config-client-dev.yaml</p>\n</blockquote>\n<h2 id=\"分组管理\"><a href=\"# 分组管理\" class=\"headerlink\" title=\"分组管理\"></a>分组管理</h2><p><img src=\"http://xtzl.wentexl.cn/%E5%88%86%E7%BB%84%E7%AE%A1%E7%90%86.png\" alt=\"分组\"></p>\n<blockquote>\n<ul>\n<li>yml 中设置分组, 意为选择 DEV 环境下的配置生效</li>\n</ul>\n</blockquote>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"attr\">group:</span> <span class=\"string\">DEV_GROUP</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<ul>\n<li>不同的组别可以存在 DataId 相同的配置</li>\n</ul>\n</blockquote>\n<h2 id=\"命名空间 NameSpace\"><a href=\"# 命名空间 NameSpace\" class=\"headerlink\" title=\"命名空间 NameSpace\"></a>命名空间 NameSpace</h2><blockquote>\n<ul>\n<li>yml 文件配置命名空间</li>\n</ul>\n</blockquote>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">f2009b56-a85a-487a-afeb-0927aa03a199</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"切换 Nacos 的数据库\"><a href=\"# 切换 Nacos 的数据库\" class=\"headerlink\" title=\"切换 Nacos 的数据库\"></a>切换 Nacos 的数据库</h1><blockquote>\n<ul>\n<li> Nacos 自带一个 derby 数据库，但是要统一使用 mysql 数据库</li>\n<li> sql 执行脚本在 nacos 的安装路径中 conf 目录下</li>\n<li>sql 执行之后，需要修改 conf 下 application.properties,(mysql8)修改如下</li>\n</ul>\n</blockquote>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring.datasource.platform=mysql</span><br><span class=\"line\">db.num=1</span><br><span class=\"line\">db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span><br><span class=\"line\">db.user.0=root</span><br><span class=\"line\">db.password.0=root</span><br></pre></td></tr></table></figure>\n","url":"/posts/33695/","min2read":3,"word4post":643,"prev_post":{"title":"Seata","url":"/posts/63021/"},"next_post":{"title":"Cloud-Alibaba-Sentinel","url":"/posts/60668/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Nacos\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">Nacos</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"依赖引入\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">依赖引入</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Nacos 注册中心\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\">Nacos 注册中心 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"服务端 Yml 配置\" href = \"#\"><span class=\"toc-number\">3.1.</span> <span class=\"toc-text\"> 服务端 Yml 配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"客户端 Yml 配置\" href = \"#\"><span class=\"toc-number\">3.2.</span> <span class=\"toc-text\">客户端 Yml 配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"客户端 Controller 层\" href = \"#\"><span class=\"toc-number\">3.3.</span> <span class=\"toc-text\">客户端 Controller 层</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Nacos- 配置中心\" href = \"#\"><span class=\"toc-number\">4.</span> <span class=\"toc-text\">Nacos 配置中心 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"核心\" href = \"#\"><span class=\"toc-number\">4.1.</span> <span class=\"toc-text\"> 核心</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"新增依赖\" href = \"#\"><span class=\"toc-number\">4.2.</span> <span class=\"toc-text\">新增依赖</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"yml 配置\" href = \"#\"><span class=\"toc-number\">4.3.</span> <span class=\"toc-text\">yml 配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"在 Nacos 端的配置文件名格式如下 - 设置 DataId\" href = \"#\"><span class=\"toc-number\">4.4.</span> <span class=\"toc-text\"> 在 Nacos 端的配置文件名格式如下(设置 DataId):</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"分组管理\" href = \"#\"><span class=\"toc-number\">4.5.</span> <span class=\"toc-text\">分组管理</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"命名空间 NameSpace\" href = \"#\"><span class=\"toc-number\">4.6.</span> <span class=\"toc-text\">命名空间 NameSpace</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"切换 Nacos 的数据库\" href = \"#\"><span class=\"toc-number\">5.</span> <span class=\"toc-text\">切换 Nacos 的数据库</span></a></li></ol>","categories":[{"name":"Alibaba-Nacos","path":"api/categories/Alibaba-Nacos.json","url":"/categories/Alibaba-Nacos/"}],"tags":[{"name":"Nacos","path":"api/tags/Nacos.json","url":"/tags/Nacos/"}]}