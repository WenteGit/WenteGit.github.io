{"title":"OpenFeign","slug":"Cloud_OpenFeign","date":"2022-07-23","updated":"2023-02-23","comments":true,"path":"api/posts/40393.json","excerpt":"<blockquote><p> 主要记录了关于 OpenFeign 服务调用的知识 </p></blockquote>","cover":null,"covers":null,"content":"<blockquote>\n<p>主要记录了关于 OpenFeign 服务调用的知识</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<h1 id=\"核心\"><a href=\"# 核心\" class=\"headerlink\" title=\"核心\"></a>核心</h1><blockquote>\n<ul>\n<li>微服务接口 + @FeignClient</li>\n<li>Feign 自带负载均衡配置项，默认支持 Ribbon</li>\n<li>OpenFeign 默认等待 1 秒钟，之后将会报超时错误</li>\n<li>面向接口编程</li>\n<li>主要就是在 80 端口多了一层 Service</li>\n<li>在 Service 层这里直接使用注解而不使用 RestTemplate</li>\n<li>更加方便和简洁</li>\n<li>@FeignClient()接口类中，使用 @RequestParam 时必须指定 value</li>\n<li>Feign 和热部署有可能会冲突，且在使用的时候，要注意接口层的参数是否有在请求体内的，如果没表明是否在请求体，会导致调用失败，如果在请求体，就要更换 httpclient 的依赖，否则可能会出现 Get 请求被自动转成 Post 请求的情况</li>\n</ul>\n</blockquote>\n<h1 id=\"依赖引入\"><a href=\"# 依赖引入\" class=\"headerlink\" title=\"依赖引入\"></a>依赖引入</h1><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"主启动类\"><a href=\"# 主启动类\" class=\"headerlink\" title=\"主启动类\"></a>主启动类</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnableFeignClients</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"80 端微服务接口\"><a href=\"#80 端微服务接口\" class=\"headerlink\" title=\"80 端微服务接口\"></a>80 端微服务接口</h1><p><strong>Serice 端</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@FeignClient(value = &quot;cloud-payment-service&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">PaymentFeignService</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里面的 GetMapping 是指的是服务实例中的方法的路径，并且会自动将获取到的路径变量加到路径中去</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> CommonResult&lt;Payment&gt; <span class=\"title function_\">getPaymentById</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>Controller 端</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderFeignController</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> PaymentFeignService paymentFeignService;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> CommonResult&lt;Payment&gt; <span class=\"title function_\">getPaymentById</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;id&quot;)</span> Long id)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> paymentFeignService.getPaymentById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"设置超时时间\"><a href=\"# 设置超时时间\" class=\"headerlink\" title=\"设置超时时间\"></a>设置超时时间</h1><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 设置 feign 客户端超时时间(OpenFeign 默认支持 ribbon)</span></span><br><span class=\"line\"><span class=\"attr\">ribbon:</span></span><br><span class=\"line\">  <span class=\"comment\"># 指的是建立连接所用的时间，适用于网络状况正常的情况下, 两端连接所用的时间</span></span><br><span class=\"line\">  <span class=\"attr\">ReadTimeout:</span> <span class=\"number\">5000</span></span><br><span class=\"line\">  <span class=\"comment\"># 指的是建立连接后从服务器读取到可用资源所用的时间</span></span><br><span class=\"line\">  <span class=\"attr\">ConnectTimeout:</span> <span class=\"number\">5000</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"设置 OpenFeign 的日志\"><a href=\"# 设置 OpenFeign 的日志\" class=\"headerlink\" title=\"设置 OpenFeign 的日志\"></a>设置 OpenFeign 的日志 </h1><h2 id=\"自定义 Config 类，加入 Bean 设置日志级别\"><a href=\"# 自定义 Config 类，加入 Bean 设置日志级别\" class=\"headerlink\" title=\"自定义 Config 类，加入 Bean 设置日志级别\"></a> 自定义 Config 类，加入 Bean 设置日志级别</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FeignConfig</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    Logger.Level <span class=\"title function_\">feignLoggerLevel</span><span class=\"params\">()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Logger.Level.FULL;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"在 yml 配置中设置日志的监控接口\"><a href=\"# 在 yml 配置中设置日志的监控接口\" class=\"headerlink\" title=\"在 yml 配置中设置日志的监控接口\"></a>在 yml 配置中设置日志的监控接口</h2><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">logging:</span></span><br><span class=\"line\">  <span class=\"attr\">level:</span></span><br><span class=\"line\">    <span class=\"comment\"># feign 日志以 debug 级别监控 com.atguigu.springcloud.service.PaymentFeignService 接口，debug 级别会直接在控制台 console 中打印出来</span></span><br><span class=\"line\">    <span class=\"attr\">xtzl.ljw.service.PaymentFeignService:</span> <span class=\"string\">debug</span></span><br></pre></td></tr></table></figure>\n","url":"/posts/40393/","min2read":2,"word4post":537,"prev_post":{"title":"Hystrix","url":"/posts/64571/"},"next_post":{"title":"Sleuth","url":"/posts/15024/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"核心\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">核心</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"依赖引入\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">依赖引入</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"主启动类\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\">主启动类</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"80 端微服务接口\" href = \"#\"><span class=\"toc-number\">4.</span> <span class=\"toc-text\">80 端微服务接口</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"设置超时时间\" href = \"#\"><span class=\"toc-number\">5.</span> <span class=\"toc-text\">设置超时时间</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"设置 OpenFeign 的日志\" href = \"#\"><span class=\"toc-number\">6.</span> <span class=\"toc-text\">设置 OpenFeign 的日志 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"自定义 Config 类，加入 Bean 设置日志级别\" href = \"#\"><span class=\"toc-number\">6.1.</span> <span class=\"toc-text\"> 自定义 Config 类，加入 Bean 设置日志级别</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"在 yml 配置中设置日志的监控接口\" href = \"#\"><span class=\"toc-number\">6.2.</span> <span class=\"toc-text\">在 yml 配置中设置日志的监控接口</span></a></li></ol></li></ol>","categories":[{"name":"SpringCloud","path":"api/categories/SpringCloud.json","url":"/categories/SpringCloud/"}],"tags":[{"name":"OpenFeign","path":"api/tags/OpenFeign.json","url":"/tags/OpenFeign/"}]}