{"title":"Cloud_Config","slug":"Cloud_Config","date":"2022-07-25","updated":"2022-07-26","comments":true,"path":"api/posts/8012.json","excerpt":"<blockquote><p> 主要总结和介绍了 SpringCloud 的常用配置 </p></blockquote>","cover":null,"covers":null,"content":"<blockquote>\n<p> 主要总结和介绍了 SpringCloud 的常用配置 </p>\n</blockquote>\n<span id=\"more\"></span>\n<blockquote>\n<p> 要测试的话，也要在 Windows 的 host 文件做修改：127.0.0.1 config-3344.com<br> 测试链接：<a href=\"http://config-3344.com:3344/main/config-dev.yml\">http://config-3344.com:3344/main/config-dev.yml</a></p>\n</blockquote>\n<h1 id=\"主启动类注解引入\"><a href=\"# 主启动类注解引入\" class=\"headerlink\" title=\"主启动类注解引入\"></a> 主启动类注解引入 </h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnableConfigServer</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"依赖引入\"><a href=\"# 依赖引入\" class=\"headerlink\" title=\"依赖引入\"></a> 依赖引入 </h1><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-config-server<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"中心 Config 的 yml- 配置\"><a href=\"# 中心 Config 的 yml- 配置\" class=\"headerlink\" title=\"中心 Config 的 yml 配置\"></a> 中心 Config 的 yml 配置 </h1><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">3344</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span>  <span class=\"string\">cloud-config-center</span> <span class=\"comment\"># 注册进 Eureka 服务器的微服务名 </span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">config:</span></span><br><span class=\"line\">      <span class=\"attr\">server:</span></span><br><span class=\"line\">        <span class=\"attr\">git:</span></span><br><span class=\"line\">          <span class=\"attr\">uri:</span> <span class=\"string\">https://gitee.com/mx0425/springcloud-config.git</span> <span class=\"comment\">#GitHub 上面的 git 仓库名字 </span></span><br><span class=\"line\">          <span class=\"comment\">#### 搜索目录 </span></span><br><span class=\"line\">          <span class=\"attr\">search-paths:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">springcloud-config</span></span><br><span class=\"line\">      <span class=\"comment\">#### 读取分支 </span></span><br><span class=\"line\">      <span class=\"attr\">label:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"comment\">#rabbitmq 相关配置 </span></span><br><span class=\"line\"><span class=\"attr\">rabbitmq:</span></span><br><span class=\"line\">  <span class=\"attr\">host:</span> <span class=\"string\">localhost</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">5672</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">guest</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">guest</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务注册到 eureka 地址 </span></span><br><span class=\"line\"><span class=\"attr\">eureka:</span></span><br><span class=\"line\">  <span class=\"attr\">client:</span></span><br><span class=\"line\">    <span class=\"attr\">service-url:</span></span><br><span class=\"line\">      <span class=\"attr\">defaultZone:</span> <span class=\"string\">http://localhost:7001/eureka</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##rabbitmq 相关配置, 暴露 bus 刷新配置的端点 </span></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoints:</span> <span class=\"comment\"># 暴露 bus 刷新配置的端点 </span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"attr\">include:</span> <span class=\"string\">&#x27;bus-refresh&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"Client 端 Config 的 yml 配置\"><a href=\"#Client 端 Config 的 yml 配置\" class=\"headerlink\" title=\"Client 端 Config 的 yml 配置\"></a>Client 端 Config 的 yml 配置 </h1><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">3355</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">config-client</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"comment\">#Config 客户端配置 </span></span><br><span class=\"line\">    <span class=\"attr\">config:</span></span><br><span class=\"line\">      <span class=\"attr\">label:</span> <span class=\"string\">main</span> <span class=\"comment\"># 分支名称 </span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">config</span> <span class=\"comment\"># 配置文件名称 </span></span><br><span class=\"line\">      <span class=\"attr\">profile:</span> <span class=\"string\">dev</span> <span class=\"comment\"># 读取后缀名称   上述 3 个综合：master 分支上 config-dev.yml 的配置文件被读取 http://config-3344.com:3344/master/config-dev.yml</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:3344</span> <span class=\"comment\"># 配置中心地址 k</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务注册到 eureka 地址 </span></span><br><span class=\"line\"><span class=\"attr\">eureka:</span></span><br><span class=\"line\">  <span class=\"attr\">client:</span></span><br><span class=\"line\">    <span class=\"attr\">service-url:</span></span><br><span class=\"line\">      <span class=\"attr\">defaultZone:</span> <span class=\"string\">http://localhost:7001/eureka</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暴露监控端点: 实现动态刷新用的 </span></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoints:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"attr\">include:</span> <span class=\"string\">&quot;*&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"Client 端手动版动态刷新\"><a href=\"#Client 端手动版动态刷新\" class=\"headerlink\" title=\"Client 端手动版动态刷新\"></a>Client 端手动版动态刷新 </h1><blockquote>\n<p><strong>Controller 层 </strong></p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> 类名上添加注解 </span><br><span class=\"line\"><span class=\"meta\">@RefreshScope</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 暴露监控端点: 实现动态刷新用的 </span></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoints:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"attr\">include:</span> <span class=\"string\">&quot;*&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p> 此时还需要发一个固定的 post 请求来刷新 </p>\n<blockquote>\n<p><strong>localhost:3355/actuator/refresh</strong></p>\n</blockquote>\n","url":"/posts/8012/","min2read":1,"word4post":403,"prev_post":{"title":"MQ","url":"/posts/44276/"},"next_post":{"title":"GateWay","url":"/posts/57702/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"主启动类注解引入\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\"> 主启动类注解引入 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"依赖引入\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\"> 依赖引入 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"中心 Config 的 yml- 配置\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\"> 中心 Config 的 yml 配置 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Client 端 Config 的 yml 配置\" href = \"#\"><span class=\"toc-number\">4.</span> <span class=\"toc-text\">Client 端 Config 的 yml 配置 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Client 端手动版动态刷新\" href = \"#\"><span class=\"toc-number\">5.</span> <span class=\"toc-text\">Client 端手动版动态刷新 </span></a></li></ol>","categories":[{"name":"Serice_Config","path":"api/categories/Serice_Config.json","url":"/categories/Serice-Config/"}],"tags":[{"name":"SpringCloudConfig","path":"api/tags/SpringCloudConfig.json","url":"/tags/SpringCloudConfig/"}]}