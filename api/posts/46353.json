{"title":"Sqlserver_View","slug":"sql-View","date":"2022-10-30","updated":"2023-02-25","comments":true,"path":"api/posts/46353.json","excerpt":"<blockquote><p> 主要讲的是视图创建的东西 </p></blockquote>","cover":null,"covers":null,"content":"<blockquote>\n<p> 主要讲的是视图创建的东西 </p>\n</blockquote>\n<span id=\"more\"></span>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use supermarket_Insert</span><br><span class=\"line\"><span class=\"comment\">-- 1.</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">view</span> V_MIS <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> major <span class=\"operator\">=</span> <span class=\"string\">&#x27;MIS&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_MIS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--2.</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">view</span> V_SSG <span class=\"keyword\">as</span> </span><br><span class=\"line\"><span class=\"keyword\">select</span> student.sno,student.sname,goods.goodsname,goods.saleprice,salebill.number </span><br><span class=\"line\"><span class=\"keyword\">from</span> student </span><br><span class=\"line\"><span class=\"keyword\">join</span> salebill </span><br><span class=\"line\"><span class=\"keyword\">on</span> student.sno <span class=\"operator\">=</span> salebill.sno </span><br><span class=\"line\"><span class=\"keyword\">join</span> goods <span class=\"keyword\">on</span> </span><br><span class=\"line\">goods.goodsno <span class=\"operator\">=</span> salebill.goodsno</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 3.</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">view</span> V_AGE <span class=\"keyword\">as</span> </span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span>,</span><br><span class=\"line\">\t(<span class=\"number\">2020</span> <span class=\"operator\">-</span> student.birthyear) <span class=\"keyword\">as</span> age</span><br><span class=\"line\"><span class=\"keyword\">from</span></span><br><span class=\"line\">\tstudent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_AGE</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 4.</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">view</span> V_COM <span class=\"keyword\">as</span></span><br><span class=\"line\"><span class=\"keyword\">select</span></span><br><span class=\"line\">\tstudent.college,</span><br><span class=\"line\">\t<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) counts_num,</span><br><span class=\"line\">\t<span class=\"built_in\">AVG</span>(<span class=\"number\">2020</span><span class=\"operator\">-</span>student.birthyear) avg_age</span><br><span class=\"line\"><span class=\"keyword\">from</span> </span><br><span class=\"line\">\tstudent</span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span></span><br><span class=\"line\">\tstudent.college</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_COM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 5.</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">view</span> V_S_CONSUME <span class=\"keyword\">as</span></span><br><span class=\"line\"><span class=\"keyword\">select</span></span><br><span class=\"line\">\tstudent.sno,</span><br><span class=\"line\">\t<span class=\"built_in\">SUM</span>(goods.saleprice <span class=\"operator\">*</span> salebill.number) cost_all,</span><br><span class=\"line\">\t<span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> goods.categoryno) goods_category_counts</span><br><span class=\"line\"><span class=\"keyword\">from</span></span><br><span class=\"line\">\tstudent</span><br><span class=\"line\"><span class=\"keyword\">join</span></span><br><span class=\"line\">\tsalebill</span><br><span class=\"line\"><span class=\"keyword\">on</span></span><br><span class=\"line\">\tstudent.sno <span class=\"operator\">=</span> salebill.sno</span><br><span class=\"line\"><span class=\"keyword\">join</span></span><br><span class=\"line\">\tgoods</span><br><span class=\"line\"><span class=\"keyword\">on</span></span><br><span class=\"line\">\tgoods.goodsno <span class=\"operator\">=</span> salebill.goodsno</span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span></span><br><span class=\"line\">\tstudent.sno</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_S_CONSUME</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--6 .</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">view</span> V_GOOODS <span class=\"keyword\">as</span> </span><br><span class=\"line\"><span class=\"keyword\">select</span></span><br><span class=\"line\">\tgoods.categoryno,</span><br><span class=\"line\">\t<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) goods_num,</span><br><span class=\"line\">\t<span class=\"built_in\">AVG</span>(goods.saleprice) avg_price,</span><br><span class=\"line\">\t<span class=\"built_in\">min</span>(goods.number) min_number</span><br><span class=\"line\"><span class=\"keyword\">from</span></span><br><span class=\"line\">\tgoods</span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span></span><br><span class=\"line\">\tgoods.categoryno</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_GOOODS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 7.</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">view</span> V_SU_GOOD <span class=\"keyword\">as</span></span><br><span class=\"line\"><span class=\"keyword\">select</span></span><br><span class=\"line\">\tgoods.supplierno,</span><br><span class=\"line\">\t<span class=\"built_in\">sum</span>(goods.number) goods_counts_rest_sum,</span><br><span class=\"line\">\t<span class=\"built_in\">AVG</span>(goods.inprice) goods_inprice_avg,</span><br><span class=\"line\">\t<span class=\"built_in\">sum</span>(<span class=\"keyword\">case</span> <span class=\"keyword\">when</span> salebill.goodsno <span class=\"keyword\">is</span> <span class=\"keyword\">null</span> <span class=\"keyword\">then</span> goods.number <span class=\"keyword\">else</span> goods.number<span class=\"operator\">+</span>salebill.number <span class=\"keyword\">end</span>) goods_counts_all_sum</span><br><span class=\"line\"><span class=\"keyword\">from</span></span><br><span class=\"line\">\tgoods</span><br><span class=\"line\"><span class=\"keyword\">left</span> <span class=\"keyword\">join</span></span><br><span class=\"line\">\tsalebill</span><br><span class=\"line\"><span class=\"keyword\">on</span></span><br><span class=\"line\">\tgoods.goodsno <span class=\"operator\">=</span> salebill.goodsno</span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span></span><br><span class=\"line\">\tgoods.supplierno</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_SU_GOOD</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 8.</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> </span><br><span class=\"line\">\t<span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">from</span></span><br><span class=\"line\">\tV_COM</span><br><span class=\"line\"><span class=\"keyword\">where</span></span><br><span class=\"line\">\tavg_age <span class=\"operator\">&gt;</span> <span class=\"number\">19</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 9.</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span></span><br><span class=\"line\">\tV_S_CONSUME</span><br><span class=\"line\"><span class=\"keyword\">where</span></span><br><span class=\"line\">\tcost_all <span class=\"operator\">&gt;</span> <span class=\"number\">20</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 10.</span></span><br><span class=\"line\"><span class=\"keyword\">select</span></span><br><span class=\"line\">\tsupplier.suppliername,</span><br><span class=\"line\">\tsupplier.number,</span><br><span class=\"line\">\tsupplier.address</span><br><span class=\"line\"><span class=\"keyword\">from</span></span><br><span class=\"line\">\tV_SU_GOOD</span><br><span class=\"line\"><span class=\"keyword\">join</span></span><br><span class=\"line\">\tsupplier</span><br><span class=\"line\"><span class=\"keyword\">on</span></span><br><span class=\"line\">\tsupplier.supplierno <span class=\"operator\">=</span> V_SU_GOOD.supplierno</span><br><span class=\"line\"><span class=\"keyword\">where</span></span><br><span class=\"line\">\tgoods_counts_rest_sum <span class=\"operator\">&lt;</span> <span class=\"number\">50</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 11.</span></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> V_MIS <span class=\"keyword\">values</span>(<span class=\"string\">&#x27;s09&#x27;</span>,<span class=\"string\">&#x27; 宋江 &#x27;</span>,<span class=\"string\">&#x27;2000&#x27;</span>,<span class=\"string\">&#x27; 男 &#x27;</span>,<span class=\"string\">&#x27;CS&#x27;</span>,<span class=\"string\">&#x27;MIS&#x27;</span>,<span class=\"string\">&#x27;wx009&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_MIS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 12.</span></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> V_MIS <span class=\"keyword\">values</span>(<span class=\"string\">&#x27;s10&#x27;</span>,<span class=\"string\">&#x27; 周瑜 &#x27;</span>,<span class=\"string\">&#x27;1999&#x27;</span>,<span class=\"string\">&#x27; 男 &#x27;</span>,<span class=\"string\">&#x27;CS&#x27;</span>,<span class=\"string\">&#x27;IT&#x27;</span>,<span class=\"string\">&#x27;wx010&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_MIS</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 13.</span></span><br><span class=\"line\"><span class=\"keyword\">update</span> V_MIS <span class=\"keyword\">set</span> sname <span class=\"operator\">=</span> <span class=\"string\">&#x27; 李欢欢 &#x27;</span> <span class=\"keyword\">where</span> sno <span class=\"operator\">=</span> <span class=\"string\">&#x27;s01&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 14.</span></span><br><span class=\"line\"><span class=\"keyword\">update</span> V_MIS <span class=\"keyword\">set</span> sname <span class=\"operator\">=</span> <span class=\"string\">&#x27; 徐慧慧 &#x27;</span> <span class=\"keyword\">where</span> sno <span class=\"operator\">=</span> <span class=\"string\">&#x27;s02&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_MIS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 15.</span></span><br><span class=\"line\"><span class=\"keyword\">update</span> V_SSG <span class=\"keyword\">set</span> saleprice <span class=\"operator\">=</span> <span class=\"number\">10</span> <span class=\"keyword\">where</span> sname <span class=\"operator\">=</span> <span class=\"string\">&#x27; 力神咖啡 &#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_SSG</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 16.</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> V_MIS <span class=\"keyword\">where</span> sno <span class=\"operator\">=</span> <span class=\"string\">&#x27;s09&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_MIS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 17.</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> V_MIS <span class=\"keyword\">where</span> sno <span class=\"operator\">=</span> <span class=\"string\">&#x27;s10&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> V_MIS</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","url":"/posts/46353/","min2read":2,"word4post":368,"prev_post":{"title":"Sqlserver_TSQL","url":"/posts/4967/"},"next_post":{"title":"Sqlserver_DQL","url":"/posts/19382/"},"toc":"","categories":[{"name":"DataBase","path":"api/categories/DataBase.json","url":"/categories/DataBase/"}],"tags":[]}