{"title":"MySQL-advanced","slug":"mysql-advanced","date":"2023-02-12","updated":"2023-02-25","comments":true,"path":"api/posts/55275.json","excerpt":"<blockquote><p> 介绍了关于 MySQL 中的高级特性 </p></blockquote>","cover":null,"covers":null,"content":"<blockquote>\n<p>介绍了关于 MySQL 中的高级特性</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"MVCC 的原理\"><a href=\"#MVCC 的原理\" class=\"headerlink\" title=\"MVCC 的原理\"></a>MVCC 的原理</h1><h2 id=\"MVCC 的介绍\"><a href=\"#MVCC 的介绍\" class=\"headerlink\" title=\"MVCC 的介绍\"></a>MVCC 的介绍</h2><blockquote>\n<p><strong>MVCC：</strong> 多版本并发控制机制 <br><strong> 作用：</strong></p>\n<ul>\n<li>可解决脏读、不可重复读的事务读写问题</li>\n<li>在保证隔离性的基础上，提升了读取效率和并发性</li>\n</ul>\n</blockquote>\n<h2 id=\"保证事务隔离性\"><a href=\"# 保证事务隔离性\" class=\"headerlink\" title=\"保证事务隔离性\"></a>保证事务隔离性</h2><p><strong>UndoLog 版本链</strong></p>\n<blockquote>\n<ul>\n<li>在执行 Update 和 Delete 操作的时候，会将每次操作记录记录在 UndoLog 中, 每条记录都有唯一的事务 ID</li>\n<li>最新的记录在链头，最老的记录在链尾  </li>\n</ul>\n</blockquote>\n<p><strong>Readview</strong></p>\n<blockquote>\n<p>记录了数据版本链的统计值: m_ids、min_trx_id、max_trx_id、creator_trx_id</p>\n<ul>\n<li>m_ids：ss 活跃事务 ID 集合(未提交的事务)</li>\n<li>min_trx_id：最老活跃事务 ID</li>\n<li>max_trx_id：最新活跃事务 ID+1 (下一个将被分配的版本 ID)</li>\n<li>creator_trx_id：当前事务 ID</li>\n</ul>\n</blockquote>\n<p><strong>选择版本</strong>  </p>\n<blockquote>\n<p><strong>四步判断法 </strong><br> 在遍历版本链的过程中<br>1，判断当前版本事务 ID == 最新活跃事务，若是，则该版本符合要求, 若不是，则继续往下判断<br>2，判断当前版本事务 ID &lt; 最老活跃事务(在创建当前事务之前就已经提交了)，若是，则该版本符合要求，若不是，则继续往下判断<br>3，判断当前版本事务 ID &gt; max_trx_id（在创建当前事务之后才有的版本), 若是，则版本不符合要求<br>4, 判断当前版本事务 ID 是否在非活跃事务中，如果不在，则说明该版本事务是已提交的事务，符合要求  </p>\n<hr>\n<p><strong>解决问题 </strong><br> 在进行 undoLog 中遍历版本链选择版本的过程中，主要找到最新的已提交的版本，从而避免了脏读，而第一事务开始前创建，之后都只使用这唯一的一个 ReadView, 则单个事务去匹配到的版本就是一样的，也就解决了不可重复读的问题</p>\n</blockquote>\n<h1 id=\"权限操作\"><a href=\"# 权限操作\" class=\"headerlink\" title=\"权限操作\"></a>权限操作 </h1><h2 id=\"查询权限\"><a href=\"# 查询权限\" class=\"headerlink\" title=\"查询权限\"></a> 查询权限</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 查询某个用户的权限</span></span><br><span class=\"line\">\t<span class=\"keyword\">SHOW</span> GRANTS <span class=\"keyword\">FOR</span> <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">SHOW</span> GRANTS <span class=\"keyword\">FOR</span> <span class=\"string\">&#x27;wendy&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"授予权限\"><a href=\"# 授予权限\" class=\"headerlink\" title=\"授予权限\"></a>授予权限</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 格式：grant 权限列表 on 数据库表. 表名 to &#x27; 用户名 &#x27;@&#x27; 主机名 &#x27; : 把某张表的哪些权限给某个用户</span></span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">ALL</span> <span class=\"keyword\">ON</span> <span class=\"operator\">*</span>.<span class=\"operator\">*</span> <span class=\"keyword\">TO</span> <span class=\"string\">&#x27;wendy&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"撤销权限\"><a href=\"# 撤销权限\" class=\"headerlink\" title=\"撤销权限\"></a>撤销权限</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">REVOKE</span> <span class=\"keyword\">ALL</span> <span class=\"keyword\">ON</span> <span class=\"operator\">*</span>.<span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> <span class=\"string\">&#x27;wendy&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"函数的使用\"><a href=\"# 函数的使用\" class=\"headerlink\" title=\"函数的使用\"></a>函数的使用</h1><h2 id=\"if-amp-amp-ifnull\"><a href=\"#if-amp-amp-ifnull\" class=\"headerlink\" title=\"if &amp;&amp; ifnull\"></a>if &amp;&amp; ifnull</h2><blockquote>\n<ul>\n<li>IFNULL 函数接受两个参数，如果不是 NULL，则返回第一个参数。否则，IFNULL 函数返回第二个参数。</li>\n<li>is null 函数 is not null 函数与上同理</li>\n</ul>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- if</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> IF(uuu <span class=\"keyword\">IS</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> ,<span class=\"string\">&#x27;1&#x27;</span>,<span class=\"string\">&#x27;2&#x27;</span>) p <span class=\"keyword\">FROM</span> users; </span><br><span class=\"line\"><span class=\"comment\">-- ifnull</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> id,IFNULL(uuu,PASSWORD) param <span class=\"keyword\">FROM</span> users;</span><br></pre></td></tr></table></figure>\n","url":"/posts/55275/","min2read":2,"word4post":662,"prev_post":{"title":"MySQL-CRUD","url":"/posts/48277/"},"next_post":{"title":"RabbitMQ","url":"/posts/15185/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"MVCC 的原理\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">MVCC 的原理</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"MVCC 的介绍\" href = \"#\"><span class=\"toc-number\">1.1.</span> <span class=\"toc-text\">MVCC 的介绍</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"保证事务隔离性\" href = \"#\"><span class=\"toc-number\">1.2.</span> <span class=\"toc-text\">保证事务隔离性</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"权限操作\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">权限操作 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"查询权限\" href = \"#\"><span class=\"toc-number\">2.1.</span> <span class=\"toc-text\"> 查询权限</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"授予权限\" href = \"#\"><span class=\"toc-number\">2.2.</span> <span class=\"toc-text\">授予权限</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"撤销权限\" href = \"#\"><span class=\"toc-number\">2.3.</span> <span class=\"toc-text\">撤销权限</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"函数的使用\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\">函数的使用</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"if-amp-amp-ifnull\" href = \"#\"><span class=\"toc-number\">3.1.</span> <span class=\"toc-text\">if &amp;&amp; ifnull</span></a></li></ol></li></ol>","categories":[{"name":"DataBase","path":"api/categories/DataBase.json","url":"/categories/DataBase/"}],"tags":[]}