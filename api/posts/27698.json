{"title":"sqlServer_command","slug":"sqlServer-command","date":"2022-10-24","updated":"2022-10-30","comments":true,"path":"api/posts/27698.json","excerpt":"<p> 关于 sqlServer 的一些命令的创建 </p>","cover":null,"covers":null,"content":"<p>关于 sqlServer 的一些命令的创建</p>\n<span id=\"more\"></span>\n\n<h1 id=\"Transact-SQL\"><a href=\"#Transact-SQL\" class=\"headerlink\" title=\"Transact-SQL\"></a>Transact-SQL</h1><h2 id=\"自定义数据类型\"><a href=\"# 自定义数据类型\" class=\"headerlink\" title=\"自定义数据类型\"></a>自定义数据类型 </h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 创建自定义数据类型</span></span><br><span class=\"line\"><span class=\"number\">1</span>, <span class=\"keyword\">create</span> type</span><br><span class=\"line\"> 例： <span class=\"keyword\">create</span> type goodsNO <span class=\"keyword\">from</span> <span class=\"type\">varchar</span>(<span class=\"number\">20</span>) <span class=\"keyword\">Not</span> <span class=\"keyword\">NULL</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2</span>, sp_addtype</span><br><span class=\"line\">例： <span class=\"keyword\">EXEC</span> sp_addtype comment,text,<span class=\"keyword\">NULL</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- EXEC ： 表示执行后面的存储过程 </span></span><br><span class=\"line\"><span class=\"comment\">-- 删除自定义数据类型</span></span><br><span class=\"line\"><span class=\"number\">1</span>, sp_droptype </span><br><span class=\"line\"> 例： <span class=\"keyword\">EXEC</span> sp_droptype goodsNo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 查看自定义的 comment 的数据类型的相关信息 </span></span><br><span class=\"line\"><span class=\"number\">2</span>, sp_help</span><br><span class=\"line\"> 例： <span class=\"keyword\">EXEC</span> sp_help comment</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"常量或变量\"><a href=\"# 常量或变量\" class=\"headerlink\" title=\"常量或变量\"></a>常量或变量 </h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 常量</span></span><br><span class=\"line\"> 日期常量：</span><br><span class=\"line\">    <span class=\"string\">&#x27;2/14/2018&#x27;</span>  表示 <span class=\"number\">2018</span> 年 <span class=\"number\">2</span>月 <span class=\"number\">14</span> 日 </span><br><span class=\"line\">    <span class=\"string\">&#x27;2018-1-19&#x27;</span>  表示 <span class=\"number\">2018</span> 年 <span class=\"number\">1</span> 月 <span class=\"number\">19</span> 日 </span><br><span class=\"line\">    <span class=\"string\">&#x27;Mar 8,2018&#x27;</span> 表示 <span class=\"number\">2018</span> 年 <span class=\"number\">3</span> 月  <span class=\"number\">8</span> 日</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 局部变量</span></span><br><span class=\"line\"><span class=\"comment\">-- 定义</span></span><br><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"variable\">@local1</span> <span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"variable\">@local2</span> <span class=\"type\">char</span>(<span class=\"number\">5</span>), <span class=\"variable\">@local3</span> <span class=\"type\">float</span></span><br><span class=\"line\"><span class=\"comment\">-- 赋值</span></span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"variable\">@local1</span> <span class=\"operator\">=</span> <span class=\"number\">56</span> <span class=\"comment\">-- 只可给单个变量赋值</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@local2</span> <span class=\"operator\">=</span> <span class=\"string\">&#x27;world&#x27;</span>, <span class=\"variable\">@local3</span> <span class=\"operator\">=</span> <span class=\"string\">&#x27;34.2&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">-- 将 table1 表中 local3 为 local1 的值的数据，赋值给自定义的变量 local2</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@local2</span>  <span class=\"operator\">=</span>  local3 <span class=\"keyword\">from</span> table1 <span class=\"keyword\">where</span> local2 <span class=\"operator\">=</span> <span class=\"variable\">@local1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 以文本形式输出</span></span><br><span class=\"line\">print(<span class=\"variable\">@local2</span>)</span><br><span class=\"line\"><span class=\"comment\">-- 以表格形式输出多个变量值</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@local2</span>, <span class=\"variable\">@local3</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"流程控制语句\"><a href=\"# 流程控制语句\" class=\"headerlink\" title=\"流程控制语句\"></a>流程控制语句</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- IF 语句</span></span><br><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"variable\">@in</span> <span class=\"type\">decimal</span>(<span class=\"number\">18</span>,<span class=\"number\">2</span>), <span class=\"variable\">@sale</span> <span class=\"type\">decimal</span>(<span class=\"number\">18</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@in</span> <span class=\"operator\">=</span> Inprice,<span class=\"variable\">@sale</span> <span class=\"operator\">=</span> SalePrice <span class=\"keyword\">from</span> goods <span class=\"keyword\">where</span> gooodsno <span class=\"operator\">=</span> <span class=\"string\">&#x27;G001&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">IF <span class=\"variable\">@in</span> <span class=\"operator\">&gt;</span> <span class=\"variable\">@sale</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27;GN001 是打折商品 &#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span> if <span class=\"variable\">@in</span> <span class=\"operator\">=</span> <span class=\"variable\">@sale</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27; 测试用例 &#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">ELSE</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27;GN001 是正价商品 &#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- Case 语句</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> expression</span><br><span class=\"line\">    <span class=\"keyword\">when</span> expression1 <span class=\"keyword\">then</span> result1</span><br><span class=\"line\">    <span class=\"keyword\">when</span> expression2 <span class=\"keyword\">then</span> result2</span><br><span class=\"line\">    <span class=\"keyword\">ELSE</span> result3</span><br><span class=\"line\"><span class=\"keyword\">END</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"游标\"><a href=\"# 游标\" class=\"headerlink\" title=\"游标\"></a>游标</h2><blockquote>\n<p><strong>示例</strong></p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 1. 游标查询</span></span><br><span class=\"line\"><span class=\"comment\">-- 建立 scroll 滚动游标</span></span><br><span class=\"line\"><span class=\"keyword\">declare</span> cur <span class=\"keyword\">scroll</span> <span class=\"keyword\">cursor</span> <span class=\"keyword\">for</span></span><br><span class=\"line\">\t<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> goods <span class=\"keyword\">join</span> category <span class=\"keyword\">on</span> goods.categoryno <span class=\"operator\">=</span> goods.categoryno <span class=\"keyword\">where</span> category.categoryname <span class=\"operator\">=</span> <span class=\"string\">&#x27; 洗发水 &#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">open</span> cur</span><br><span class=\"line\"><span class=\"keyword\">fetch</span> <span class=\"keyword\">first</span> <span class=\"keyword\">from</span> cur </span><br><span class=\"line\"><span class=\"keyword\">fetch</span> <span class=\"keyword\">last</span> <span class=\"keyword\">from</span> cur</span><br><span class=\"line\"><span class=\"keyword\">fetch</span> absolute <span class=\"number\">10</span> <span class=\"keyword\">from</span> cur</span><br><span class=\"line\"><span class=\"keyword\">fetch</span> relative <span class=\"number\">5</span> <span class=\"keyword\">from</span> cur</span><br><span class=\"line\"><span class=\"keyword\">close</span> cur</span><br><span class=\"line\"><span class=\"keyword\">deallocate</span> cur</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 2. 游标更新</span></span><br><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"variable\">@Id</span> <span class=\"type\">char</span>(<span class=\"number\">6</span>); <span class=\"comment\">-- 声明临时变量</span></span><br><span class=\"line\"><span class=\"comment\">-- 声明更新游标</span></span><br><span class=\"line\"><span class=\"keyword\">declare</span> cur_up <span class=\"keyword\">scroll</span> <span class=\"keyword\">cursor</span> <span class=\"keyword\">for</span> </span><br><span class=\"line\">\t(<span class=\"keyword\">select</span> goodsno <span class=\"keyword\">from</span> goods <span class=\"keyword\">join</span> category <span class=\"keyword\">on</span> goods.categoryno <span class=\"operator\">=</span> category.categoryno <span class=\"keyword\">where</span> category.categoryname <span class=\"operator\">=</span> <span class=\"string\">&#x27; 咖啡 &#x27;</span>) <span class=\"keyword\">for</span> <span class=\"keyword\">update</span> <span class=\"keyword\">of</span> saleprice;</span><br><span class=\"line\"><span class=\"keyword\">open</span> cur_up;</span><br><span class=\"line\"><span class=\"keyword\">fetch</span> next <span class=\"keyword\">from</span> cur_up</span><br><span class=\"line\"><span class=\"keyword\">into</span> <span class=\"variable\">@Id</span>;</span><br><span class=\"line\">while @<span class=\"variable\">@FETCH</span>_STATUS <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">\t<span class=\"keyword\">update</span> goods <span class=\"keyword\">set</span> saleprice <span class=\"operator\">=</span> saleprice <span class=\"operator\">*</span><span class=\"number\">0.9</span> <span class=\"keyword\">where</span> goods.goodsno <span class=\"operator\">=</span> <span class=\"variable\">@Id</span></span><br><span class=\"line\">\t<span class=\"comment\">-- 切换</span></span><br><span class=\"line\">\t<span class=\"keyword\">fetch</span> next <span class=\"keyword\">from</span> cur_up</span><br><span class=\"line\">\t<span class=\"keyword\">into</span> <span class=\"variable\">@Id</span></span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"><span class=\"keyword\">close</span> cur_up</span><br><span class=\"line\"><span class=\"keyword\">deallocate</span> cur_up</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"触发器\"><a href=\"# 触发器\" class=\"headerlink\" title=\"触发器\"></a>触发器</h2><blockquote>\n<hr>\n<p><strong>instead of 前置触发器 </strong><br>instead of 触发器是在 insert、update、delee 这些操作进行之前就被激活了。<br> 并且不再去执行原来的 SQL 操作，而是用触发器内部的 SQL 语句代替执行。  </p>\n<hr>\n<p><strong>after 后置触发器</strong><br>after 后置触发器是执行完原 sql 语句之后才会执行的触发器</p>\n<hr>\n<p><strong>示例</strong></p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 3. 触发器实现商品的购买</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">trigger</span> sale_trigger</span><br><span class=\"line\"><span class=\"keyword\">on</span>\tsalebill</span><br><span class=\"line\">after <span class=\"keyword\">insert</span> <span class=\"keyword\">as</span></span><br><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"variable\">@changenum</span> <span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"variable\">@change</span>_goodsno <span class=\"type\">char</span>(<span class=\"number\">6</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@changenum</span> <span class=\"operator\">=</span> number <span class=\"keyword\">from</span> inserted </span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@change</span>_goodsno <span class=\"operator\">=</span> goodsno <span class=\"keyword\">from</span> inserted</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">\t<span class=\"keyword\">update</span> goods <span class=\"keyword\">set</span> number <span class=\"operator\">=</span> (number <span class=\"operator\">-</span> <span class=\"variable\">@changenum</span>) <span class=\"keyword\">where</span> goods.goodsno <span class=\"operator\">=</span> <span class=\"variable\">@change</span>_goodsno</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 激活对应表中某个触发器, 如果要激活所有的，就把触发器名改为 all</span></span><br><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> salebill enable <span class=\"keyword\">trigger</span> sale_trigger</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","url":"/posts/27698/","min2read":2,"word4post":630,"prev_post":{"title":"sql_DDL","url":"/posts/56248/"},"next_post":{"title":"JUC","url":"/posts/30559/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Transact-SQL\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">Transact-SQL</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"自定义数据类型\" href = \"#\"><span class=\"toc-number\">1.1.</span> <span class=\"toc-text\">自定义数据类型 </span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"常量或变量\" href = \"#\"><span class=\"toc-number\">1.2.</span> <span class=\"toc-text\">常量或变量 </span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"流程控制语句\" href = \"#\"><span class=\"toc-number\">1.3.</span> <span class=\"toc-text\">流程控制语句</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"游标\" href = \"#\"><span class=\"toc-number\">1.4.</span> <span class=\"toc-text\">游标</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"触发器\" href = \"#\"><span class=\"toc-number\">1.5.</span> <span class=\"toc-text\">触发器</span></a></li></ol></li></ol>","categories":[{"name":"DataBase","path":"api/categories/DataBase.json","url":"/categories/DataBase/"}],"tags":[]}